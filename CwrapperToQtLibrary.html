<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-09-27 Mon 19:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C Wrappers for C++ Libraries and Interoperability</title>
<meta name="generator" content="Org mode" />
<meta name="description" content="cpp/c++ interoperability ffi shim qt5 widgets gui library wrapper julia dlang"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
<link href="theme/org-nav-theme.css" rel="stylesheet">
<script src="theme/org-nav-theme.js"></script>
<link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "%LINEBREAKS" },
                        webFont: "%FONT"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "%LINEBREAKS" },
              font: "%FONT"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "%AUTONUMBER"},
               MultLineWidth: "%MULTLINEWIDTH",
               TagSide: "%TAGSIDE",
               TagIndent: "%TAGINDENT"
             }
});
</script>
<script type="text/javascript"
        src="theme/MathJax/MathJax.js"></script>
</head>
<body>
<div id="content">
<h1 class="title">C Wrappers for C++ Libraries and Interoperability</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org32addb9">1. C Wrappers for C++ Libraries and Interoperability</a>
<ul>
<li><a href="#orgac71631">1.1. Overview</a></li>
<li><a href="#org70fa9fb">1.2. Calling C++ from C</a></li>
<li><a href="#orgb243765">1.3. Calling Qt5 Widgets library from many languages</a>
<ul>
<li><a href="#org6740028">1.3.1. Overview</a></li>
<li><a href="#org5a46c7d">1.3.2. Wrapper Files</a></li>
<li><a href="#org308a7b2">1.3.3. Building the wrapper file.</a></li>
<li><a href="#org52a34f7">1.3.4. C client code</a></li>
<li><a href="#org74f6390">1.3.5. Python3 Client Code</a></li>
<li><a href="#orgd987ed5">1.3.6. Julia Client Code (loader.jl)</a></li>
<li><a href="#orgb4964b9">1.3.7. C# - Dotnet Core Client Code</a></li>
<li><a href="#orgefec1a7">1.3.8. D language - D-lang Client Code</a></li>
<li><a href="#org7f02432">1.3.9. <span class="todo TODO">TODO</span> Rust client code</a></li>
<li><a href="#orgf1a910f">1.3.10. Common Lisp client code</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org32addb9" class="outline-2">
<h2 id="org32addb9"><span class="section-number-2">1</span> C Wrappers for C++ Libraries and Interoperability</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgac71631" class="outline-3">
<h3 id="orgac71631"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
<p>
One of the main advantages of the C language is the the possibility of
calling libraries written in C from other programming languages via
FFI (Foreign Function Interface), which allows calling C functions
from C shared libraries. Unlike C, calling C++ libraries directly via
FFI is not feasible as C++ lacks a standard ABI - Application Binary
interface. A solution for this issue is to create a C wrapper for the
C++ library using <span class="underline">opaque pointer</span>, <span class="underline">incomplete types</span> and <span class="underline">extern C</span>
annotation.
</p>
</div>
</div>

<div id="outline-container-org70fa9fb" class="outline-3">
<h3 id="org70fa9fb"><span class="section-number-3">1.2</span> Calling C++ from C</h3>
<div class="outline-text-3" id="text-1-2">
<p>
This section presents how to call a statically linked C++ cod from C.
</p>

<ul class="org-ul">
<li>Complete code:  <a href="https://gist.github.com/caiorss/c236aedbbb514717ad26e856654bb063">Example GIST - calling C++ from C</a></li>
</ul>

<p>
File: <b>cppcode.hpp</b>
</p>
<ul class="org-ul">
<li>Header file that can be used by a C or C++ code. All code between
#ifndef __cplusplus &#x2026; #edif is ignored by a C compiler.</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#if</span><span class="org-negation-char"><span class="org-preprocessor">n</span></span><span class="org-preprocessor">def</span> _CODECPP_
<span class="org-preprocessor">#define</span> <span class="org-variable-name">_CODECPP_</span>

<span class="org-preprocessor">#ifdef</span> __cplusplus
<span class="org-preprocessor">  #define</span> <span class="org-variable-name">EXPORT_C</span> <span class="org-keyword">extern</span> <span class="org-string">"C"</span>
<span class="org-preprocessor">#else</span>
<span class="org-preprocessor">  #define</span> <span class="org-variable-name">EXPORT_C</span>
<span class="org-preprocessor">#endif</span>

<span class="org-comment-delimiter">//</span><span class="org-comment">============ C++ Only Header =================//</span>
<span class="org-preprocessor">#ifdef</span> __cplusplus  <span class="org-comment-delimiter">// </span><span class="org-comment">Enabled only for C++ compilers</span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-keyword">class</span> <span class="org-type">Runstat</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">/// </span><span class="org-comment">Sum of sequence processed</span>
    <span class="org-type">double</span> <span class="org-variable-name">m_sum</span>;
    <span class="org-comment-delimiter">/// </span><span class="org-comment">Sum of squares processed</span>
    <span class="org-type">double</span> <span class="org-variable-name">m_sumsq</span>;
    <span class="org-comment-delimiter">/// </span><span class="org-comment">Size of sequence processed</span>
    <span class="org-type">size_t</span> <span class="org-variable-name">m_N</span>;
<span class="org-function-name">public</span>:
    <span class="org-function-name">Runstat</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-function-name">Runstat</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">Runstat</span> <span class="org-keyword">const</span>&amp;<span class="org-rainbow-delimiters-depth-2">)</span>            = <span class="org-keyword">delete</span>;
    <span class="org-type">Runstat</span>&amp; <span class="org-keyword">operator</span><span class="org-function-name">=</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">Runstat</span> <span class="org-keyword">const</span>&amp;<span class="org-rainbow-delimiters-depth-2">)</span> = <span class="org-keyword">delete</span>;
    ~<span class="org-function-name">Runstat</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-type">void</span>   <span class="org-function-name">add</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">void</span>   <span class="org-function-name">reset</span><span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-type">size_t</span> <span class="org-function-name">size</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>;
    <span class="org-type">double</span> <span class="org-function-name">mean</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>;
    <span class="org-comment-delimiter">/// </span><span class="org-comment">Standard deviation</span>
    <span class="org-type">double</span> <span class="org-function-name">sdev</span><span class="org-rainbow-delimiters-depth-2">()</span> <span class="org-keyword">const</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-preprocessor">#endif</span> <span class="org-comment-delimiter">//</span><span class="org-comment">-- End of __cplusplus definition //</span>


<span class="org-comment-delimiter">// </span><span class="org-comment">========== C-interface for std::string container</span>
<span class="org-keyword">typedef</span>  <span class="org-type">void</span>* <span class="org-type">hString</span>;

EXPORT_C <span class="org-type">hString</span> <span class="org-function-name">string_new</span><span class="org-rainbow-delimiters-depth-1">()</span>;
EXPORT_C <span class="org-type">hString</span> <span class="org-function-name">string_new1</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">hString</span> <span class="org-function-name">string_copy</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">void</span>    <span class="org-function-name">string_del</span>  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">void</span>    <span class="org-function-name">string_add</span>  <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">void</span>    <span class="org-function-name">string_disp</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-comment-delimiter">//</span><span class="org-comment">============ C-interface for class Runstat ============//</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Opaque pointer type alias for C-lang</span>
<span class="org-keyword">typedef</span> <span class="org-type">void</span>* <span class="org-type">pStat</span>;

EXPORT_C <span class="org-type">pStat</span>   <span class="org-function-name">Runstat_new</span><span class="org-rainbow-delimiters-depth-1">()</span>;
EXPORT_C <span class="org-type">void</span>    <span class="org-function-name">Runstat_del</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">void</span>    <span class="org-function-name">Runstat_add</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span>, <span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">double</span>  <span class="org-function-name">Runstat_mean</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">double</span>  <span class="org-function-name">Runstat_sdev</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
EXPORT_C <span class="org-type">size_t</span>  <span class="org-function-name">Runstat_size</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-preprocessor">#endif</span>
</pre>
</div>

<p>
File: <b>cppcode.cpp</b>
</p>
<ul class="org-ul">
<li>Implementation of classes and C interface functions.</li>
</ul>

<p>
Implementation of class RunStat member functions:
</p>

<div class="org-src-container">
<pre class="src src-cpp">  ... ... ... ...

 <span class="org-constant">Runstat</span>::Runstat<span class="org-rainbow-delimiters-depth-1">()</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Object created Ok."</span> &lt;&lt; <span class="org-constant">std</span>::endl;
     m_sum = 0.0;
     m_sumsq = 0.0;
     m_N = 0;
 <span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-constant">Runstat</span>::~<span class="org-function-name">Runstat</span><span class="org-rainbow-delimiters-depth-1">()</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Object deleted OK"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
 <span class="org-rainbow-delimiters-depth-1">}</span>

 <span class="org-type">void</span>
 <span class="org-constant">Runstat</span>::<span class="org-function-name">add</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
     m_sum += x;
     m_sumsq += x * x;
     m_N++;
 <span class="org-rainbow-delimiters-depth-1">}</span>

 ...... ....   ...... ....   ...... ....

 <span class="org-constant">Runstat</span>::~Runstat<span class="org-rainbow-delimiters-depth-1">()</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
     <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Object deleted OK"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
 <span class="org-rainbow-delimiters-depth-1">}</span>

 ...... ....   ...... ....   ...... ....

 <span class="org-type">void</span>
 <span class="org-constant">Runstat</span>::add<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>
 <span class="org-rainbow-delimiters-depth-1">{</span>
     m_sum += x;
     m_sumsq += x * x;
     m_N++;
 <span class="org-rainbow-delimiters-depth-1">}</span>

... ...  ... ...  ... ...  ... ...
</pre>
</div>

<p>
Implementation of the C-interface functions for class std::string.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">//</span><span class="org-comment">--------- C-Interface for class std::string ------------------//</span>

<span class="org-type">hString</span> <span class="org-function-name">string_new</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">{}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">hString</span> <span class="org-function-name">string_new1</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">(</span>text<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Copy constructor</span>
<span class="org-type">hString</span> <span class="org-function-name">string_copy</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::<span class="org-type">string</span>* <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-constant">std</span>::<span class="org-type">string</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-constant">std</span>::<span class="org-type">string</span><span class="org-rainbow-delimiters-depth-2">(</span>*p<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">string_del</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">delete</span> <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-constant">std</span>::<span class="org-type">string</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">string_add</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-constant">std</span>::<span class="org-type">string</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    *p = *p + text;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">string_disp</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">hString</span> <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-constant">std</span>::<span class="org-type">string</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-constant">std</span>::cout &lt;&lt; name &lt;&lt; <span class="org-string">" / std::string{ "</span> &lt;&lt; *p &lt;&lt; <span class="org-string">"} "</span> &lt;&lt; <span class="org-constant">std</span>::endl;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Implementation of the C-interface functions for class RunStat.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">//</span><span class="org-comment">---------- C-Interface for class Runstat ---------------------//</span>

<span class="org-type">pStat</span> <span class="org-function-name">Runstat_new</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">Runstat</span><span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">Runstat_del</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">delete</span> <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Runstat</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">Runstat_add</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span>, <span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Runstat</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    p-&gt;add<span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">double</span> <span class="org-function-name">Runstat_mean</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">Runstat</span>* <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Runstat</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> p-&gt;mean<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">double</span> <span class="org-function-name">Runstat_sdev</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">Runstat</span>* <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Runstat</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> p-&gt;sdev<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-type">size_t</span> <span class="org-function-name">Runstat_size</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">pStat</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">Runstat</span>* <span class="org-variable-name">p</span> = <span class="org-keyword">reinterpret_cast</span><span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">Runstat</span>*<span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> p-&gt;size<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>File: main.c</b>
</p>
<ul class="org-ul">
<li>C client code that uses C-interface functions export by the C++ file cppcode.</li>
</ul>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">stdio.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">stdlib.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string">"codecpp.hpp"</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\n == EXPERIMENT 1 - std::string C-wrapper ======\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">hString</span> <span class="org-variable-name">str</span> = string_new1<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"A C++ string in C"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    string_disp<span class="org-rainbow-delimiters-depth-2">(</span>str, <span class="org-string">"str"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">hString</span> <span class="org-variable-name">str2</span> = string_copy<span class="org-rainbow-delimiters-depth-2">(</span>str<span class="org-rainbow-delimiters-depth-2">)</span>;
    string_add<span class="org-rainbow-delimiters-depth-2">(</span>str, <span class="org-string">" - hello world"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    string_disp<span class="org-rainbow-delimiters-depth-2">(</span>str, <span class="org-string">"str"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    string_disp<span class="org-rainbow-delimiters-depth-2">(</span>str2, <span class="org-string">"str2"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    string_del<span class="org-rainbow-delimiters-depth-2">(</span>str<span class="org-rainbow-delimiters-depth-2">)</span>;
    string_del<span class="org-rainbow-delimiters-depth-2">(</span>str2<span class="org-rainbow-delimiters-depth-2">)</span>;

    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\n == EXPERIMENT 2 - Class Runstat ======\n"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">pStat</span> <span class="org-variable-name">obj</span> = Runstat_new<span class="org-rainbow-delimiters-depth-2">()</span>;
    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, 10.0<span class="org-rainbow-delimiters-depth-2">)</span>;
    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, 4.0<span class="org-rainbow-delimiters-depth-2">)</span>;
    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, 25.0<span class="org-rainbow-delimiters-depth-2">)</span>;
    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, 16.0<span class="org-rainbow-delimiters-depth-2">)</span>;

    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Number of Elements processed = %zu \n"</span>, Runstat_size<span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Mean = %.5f \n"</span>, Runstat_mean<span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Sdev = %.5f \n"</span>, Runstat_sdev<span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, -50.0<span class="org-rainbow-delimiters-depth-2">)</span>;
    Runstat_add<span class="org-rainbow-delimiters-depth-2">(</span>obj, 80.0<span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Mean = %.5f \n"</span>, Runstat_mean<span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Sdev = %.5f \n"</span>, Runstat_sdev<span class="org-rainbow-delimiters-depth-3">(</span>obj<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Delete C++ Object</span>
    Runstat_del<span class="org-rainbow-delimiters-depth-2">(</span>obj<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
<b>File: CMakeLists.txt</b>
</p>

<div class="org-src-container">
<pre class="src src-cpp">cmake_minimum_required<span class="org-rainbow-delimiters-depth-1">(</span>VERSION 3.9<span class="org-rainbow-delimiters-depth-1">)</span>
project<span class="org-rainbow-delimiters-depth-1">(</span> CallCppFromC<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-function-name">set</span><span class="org-rainbow-delimiters-depth-1">(</span>CMAKE_CXX_STANDARD 17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-function-name">set</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">CMAKE_VERBOSE_MAKEFILE</span> <span class="org-variable-name">ON</span><span class="org-rainbow-delimiters-depth-1">)</span>

add_executable<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">main</span> <span class="org-variable-name">main</span>.c codecpp.cpp codecpp.hpp<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Manual compilation:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Generate object code codecpp.o</span>
$ g++ codecpp.cpp -o <span class="org-keyword">codecpp.o</span> -c -std=c++1z -Wall -g

<span class="org-comment-delimiter"># </span><span class="org-comment">Generate object-code main.o</span>
$ gcc main.c -o <span class="org-keyword">main.o</span> -c -g

<span class="org-comment-delimiter"># </span><span class="org-comment">Link =&gt; generate main.bin</span>
$ g++ main.o codecpp.o -o <span class="org-keyword">main.bin</span>
</pre>
</div>

<p>
Program output:
</p>

<div class="org-src-container">
<pre class="src src-sh">./main.bin

 == EXPERIMENT 1 - std::string C-wrapper ======
str / std::string{ A C++ string<span class="org-keyword"> in</span> C}
str / std::string{ A C++ string<span class="org-keyword"> in</span> C - hello world}
str2 / std::string{ A C++ string<span class="org-keyword"> in</span> C}

 == EXPERIMENT 2 - Class Runstat ======
 [TRACE] Object created Ok.
 Number of Elements processed = 4
 Mean = 13.75000
 Sdev = 8.95824
 Mean = 14.16667
 Sdev = 41.69612
 [TRACE] Object deleted OK
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb243765" class="outline-3">
<h3 id="orgb243765"><span class="section-number-3">1.3</span> Calling Qt5 Widgets library from many languages</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org6740028" class="outline-4">
<h4 id="org6740028"><span class="section-number-4">1.3.1</span> Overview</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
This sample code provides a C wrapper to the QT5 Widgets GUI
library. This C-wrapper allows calling Qt5 from C, Julia language and
also D-language.
</p>


<p>
<b>Documentation of features used in this experiment</b>
</p>

<p>
QT5 Documentation for widgets classes used in the sample code: 
</p>

<ul class="org-ul">
<li><a href="https://doc.qt.io/qt-5/qobject.html">QObject Class | Qt Core 5.15.0</a></li>

<li><a href="https://doc.qt.io/qt-5/qwidget.html">QWidget Class | Qt Widgets 5.15.0</a></li>

<li><a href="https://doc.qt.io/qt-5/qapplication.html">QApplication Class | Qt Widgets 5.15.0</a></li>

<li><a href="https://doc.qt.io/qt-5/qpushbutton.html">QPushButton Class | Qt Widgets 5.15.0</a></li>

<li><a href="https://doc.qt.io/qt-5/qdoublespinbox.html">QDoubleSpinBox Class | Qt Widgets 5.15.0</a></li>
</ul>


<p>
Python 3 Ctypes FFI Documentation: 
</p>

<ul class="org-ul">
<li><a href="https://docs.python.org/3/library/ctypes.html">Python 3 Ctypes</a> (Official Documentation)</li>

<li><a href="https://www.programiz.com/python-programming/closure">Python Closures</a> - Programiz</li>

<li><a href="https://pgi-jcns.fz-juelich.de/portal/pages/using-c-from-python.html">Using C from Python: How to create a ctypes wrapper</a> - Julich Scientific IT Software.</li>

<li><a href="https://www.cl.cam.ac.uk/~jdy22/papers/ctypes-foreign-calls-in-your-native-language.pdf">ctypes: foreign calls in your native language</a> - Jeremy Yallop - University of Cambridge</li>

<li><a href="http://www.dalkescientific.com/writings/NBN/ctypes.html">Python 2.5 Ctypes</a> - Dalke Scientific</li>

<li><a href="https://scipy.github.io/old-wiki/pages/Cookbook/Ctypes.html">Scipy Cookbook - Ctypes</a></li>

<li><a href="https://stackoverflow.com/questions/874245/python-ctypes-and-function-pointers">Python ctypes and function pointers</a> (StackOverflow)</li>

<li><a href="https://stackoverflow.com/questions/25014191/python-ctypes-function-pointer">Python ctypes function pointer</a> (StackOverflow)</li>

<li><a href="https://dbader.org/blog/python-ctypes-tutorial-part-2">Interfacing Python and C: Advanced "ctypes" Features</a></li>

<li><a href="https://doc.sagemath.org/html/en/thematic_tutorials/numerical_sage/ctypes.html">Sagemath - Python Ctypes</a></li>

<li><a href="https://www.cs.unc.edu/~gb/blog/2007/02/11/ctypes-tricks/">Python Ctypes for wrapping OpenCV</a></li>
</ul>


<p>
Julia language: 
</p>

<ul class="org-ul">
<li><a href="https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/">Calling C and Fortran Code · The Julia Language</a></li>

<li><a href="https://docs.julialang.org/en/v1/manual/embedding/">Embedding Julia · The Julia Language</a></li>

<li><a href="https://en.wikipedia.org/wiki/Julia_(programming_language)">Julia (programming language) - Wikipedia</a></li>

<li><a href="https://www.nature.com/articles/d41586-019-02310-3">Julia: come for the syntax, stay for the speed</a> - Nature Magazine</li>

<li><a href="https://juliabyexample.helpmanual.io/">Julia By Example</a></li>
</ul>

<p>
C# (Csharp) for Dotnet Core:
</p>

<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet">https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/core/install/linux-scripted-manual">Microsoft - Install the .NET SDK or the .NET Runtime manually</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/csharp/">C# Official Documentation</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/framework/interop/consuming-unmanaged-dll-functions">Consuming Unmanaged DLL Functions</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.intptr.zero?view=net-5.0">IntPtr.Zero Field</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/framework/interop/exposing-dotnet-components-to-com">Exposing .NET components to COM</a></li>

<li><a href="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order">Microsft - Dynamic-Link Library Search Order</a></li>

<li>Scott Hanselman - <a href="https://radu-matei.com/blog/self-contained-dotnet-cli/">Building self-contained, single executable .NET Core 3 CLI tools</a></li>

<li><a href="https://docs.microsoft.com/en-us/dotnet/core/deploying/single-file">Microsft - Single file deployment and executable</a></li>

<li><a href="https://www.hanselman.com/blog/exploring-the-new-net-dotnet-command-line-interface-cli">Exploring the new .NET "dotnet" Command Line Interface (CLI)</a></li>
</ul>


<p>
D Language (DLang: 
</p>

<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/D_(programming_language)">D (programming language) - Wikipedia</a></li>

<li><a href="https://dlang.org/blog/2017/12/05/interfacing-d-with-c-getting-started/">Interfacing D with C: Getting Started – The D Blog</a></li>

<li><a href="https://dlang.org/spec/interfaceToC.html">Interfacing to C - D Programming Language</a></li>

<li><a href="https://forum.dlang.org/thread/o3sb8m$24vp$1@digitalmars.com">Using dlopen/dlsym - D Programming Language Discussion Forum</a></li>

<li><a href="https://dlang.org/spec/cpp_interface.html">Interfacing to C++ - D Programming Language</a></li>
</ul>

<p>
Lisp - SBCL (Steel Bank Common Lisp): 
</p>

<ul class="org-ul">
<li><a href="http://www.sbcl.org/">http://www.sbcl.org/</a> - Steel Bank Common Lisp</li>

<li><a href="https://linux.die.net/man/1/sbcl#:~:text=To%20run%20SBCL,%20type%20%22sbcl,wait%20for%20your%20next%20input.&amp;text=Most%20people%20like%20to%20run%20SBCL%20as%20a%20subprocess%20under%20Emacs.">sbcl(1): Steel Bank Common Lisp - Linux man page</a></li>

<li><a href="https://common-lisp.net/~loliveira/tmp/old/cffi-newtypes/cffi-manual.html">CFFI User Manual</a></li>

<li><a href="https://z0ltan.wordpress.com/2016/09/16/interop-mini-series-calling-c-and-c-code-from-common-lisp-using-cffi-part-1/">Interop mini-series – Calling C and C++ code Lisp using CFFI (Part 1)</a></li>

<li><a href="https://gist.github.com/lamberta/212533/c4ac72b6606666ace8d35ada018614cbb1d273d6">use C shared lib with cffi · GitHub</a></li>

<li><a href="https://gist.github.com/lagagain/df1b97eb08e57c2759c950efc3a2c7dd">practice - Common Lisp hello CFFI (Common Lisp + C) · GitHub</a></li>

<li><a href="https://www.xach.com/lisp/buildapp/">Buildapp - Create executables with SBCL or CCL</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5a46c7d" class="outline-4">
<h4 id="org5a46c7d"><span class="section-number-4">1.3.2</span> Wrapper Files</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>GIST with all sources:
<ul class="org-ul">
<li><a href="https://gist.github.com/a59d0f1b17d286dad19842932c931e92">https://gist.github.com/a59d0f1b17d286dad19842932c931e92</a></li>
</ul></li>
</ul>

<p>
<b>Source code for C-wrapper</b> 
</p>

<p>
File: <span class="underline">Makefile</span>
</p>

<div class="org-src-container">
<pre class="src src-makefile"><span class="org-comment-delimiter"># </span><span class="org-comment">Build C wrapper to Qt library</span>
<span class="org-function-name"><span class="org-makefile-targets">wrapper</span></span>:
        cmake -H. -B_build -DCMAKE_BUILD_TYPE=Debug
        cmake --build _build --target all 

<span class="org-comment-delimiter"># </span><span class="org-comment">Run python client code</span>
<span class="org-function-name"><span class="org-makefile-targets">python</span></span>:
        env LD_LIBRARY_PATH=$(<span class="org-variable-name">PWD</span>)/_build ./pywrapper.py

<span class="org-comment-delimiter"># </span><span class="org-comment">Build and run dotnet client code</span>
<span class="org-function-name"><span class="org-makefile-targets">dotnet</span></span>:
        env LD_LIBRARY_PATH=$(<span class="org-variable-name">PWD</span>)/_build dotnet build myapp.csproj
        env LD_LIBRARY_PATH=$(<span class="org-variable-name">PWD</span>)/_build ./bin/myapp 

<span class="org-comment-delimiter"># </span><span class="org-comment">Build rust client</span>
<span class="org-function-name"><span class="org-makefile-targets">rust</span></span>:
        rustc rustclient.rs -l qtwrapper -L_build/
</pre>
</div>

<p>
File: <span class="underline">CMakeLists.txt</span>
</p>

<div class="org-src-container">
<pre class="src src-cmake"><span class="org-function-name">cmake_minimum_required</span>(VERSION 3.9)
<span class="org-function-name">project</span>(Qt5_Widgets_Template)

<span class="org-comment">#====== Global Configurations ==================#</span>

<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD 17)
<span class="org-function-name">set</span>(CMAKE_CXX_STANDARD_REQUIRED ON)
<span class="org-function-name">set</span>(CMAKE_VERBOSE_MAKEFILE ON)

<span class="org-function-name">set</span>(CMAKE_INCLUDE_CURRENT_DIR ON)
<span class="org-function-name">set</span>(CMAKE_AUTOUIC ON)
<span class="org-function-name">set</span>(CMAKE_AUTOMOC ON)
<span class="org-function-name">set</span>(CMAKE_AUTORCC ON)

<span class="org-comment"># Export ALL DLLs symbols on Windows without __declspec(xxxx) annotations.</span>
<span class="org-function-name">set</span>(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS true)

<span class="org-function-name">find_package</span>(Qt5 COMPONENTS Core Widgets Network UiTools REQUIRED)

<span class="org-comment">#=============== Target Configurations ============#</span>

<span class="org-comment"># --------------------------------------------------#</span>
          <span class="org-function-name">add_library</span>( qtwrapper SHARED qtwrapper.cpp )
<span class="org-function-name">target_link_libraries</span>( qtwrapper PRIVATE Qt5::Core Qt5::Gui Qt5::Widgets )

       <span class="org-function-name">add_executable</span>( client1  client1.c )
<span class="org-function-name">target_link_libraries</span>( client1  qtwrapper )

</pre>
</div>

<p>
File: <span class="underline">qtwrapper.cpp</span>
</p>

<ul class="org-ul">
<li>C-wrapper or C-interface for QT5 C++ GUI library</li>
</ul>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">QtWidgets</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">QApplication</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">QtUiTools/QtUiTools</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">QSysInfo</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">QtConcurrent/QtConcurrent</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">functional</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">iostream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">fstream</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">string</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">map</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span> 

<span class="org-comment-delimiter">/** </span><span class="org-comment">extern "C" =&gt;  Remove C++ name mangling and makes the function </span>
<span class="org-comment"> * compatible with C. It enforces C linkage to the annotated symbol. </span>
<span class="org-comment"> **-----------------------------------------------------------------*/</span>
<span class="org-preprocessor">#define</span> <span class="org-variable-name">EXPORT_C</span> <span class="org-keyword">extern</span> <span class="org-string">"C"</span>

<span class="org-comment-delimiter">/** </span><span class="org-comment">Delete any instance of a derived class of QObject</span>
<span class="org-comment"> * Note: It can be used for deleting instances QWidget, QApplication or QLayout.</span>
<span class="org-comment"> */</span>
<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_del</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">delete</span> self;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-keyword">const</span> <span class="org-type">char</span>* qt_qobject_ClassName<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> self-&gt;metaObject<span class="org-rainbow-delimiters-depth-2">()</span>-&gt;className<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_dumpObjectInfo</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    self-&gt;dumpObjectInfo<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_dumpObjectTree</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    self-&gt;dumpObjectTree<span class="org-rainbow-delimiters-depth-2">()</span>; 
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    qDebug<span class="org-rainbow-delimiters-depth-2">()</span> &lt;&lt; <span class="org-string">" [QOBjec] "</span> &lt;&lt; self;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">enum</span> <span class="org-keyword">class</span> <span class="org-type">WidgetType</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
      <span class="org-variable-name">Window</span>         = 1
    , <span class="org-variable-name">Window_main</span>    = 2
    , <span class="org-variable-name">QPushButton</span>    = 3
    , <span class="org-variable-name">QLabel</span>         = 4
    , <span class="org-variable-name">QLineEdit</span>      = 5
    , <span class="org-variable-name">QDoubleSpinBox</span> = 6
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">using</span> <span class="org-type">CtorFunction</span> = <span class="org-constant">std</span>::<span class="org-type">function</span><span class="org-rainbow-delimiters-depth-1">&lt;</span>QWidget* <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>;
<span class="org-keyword">using</span> <span class="org-type">CtorDatabase</span> = <span class="org-constant">std</span>::<span class="org-type">map</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-type">int</span>, <span class="org-type">CtorFunction</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>;

<span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-1">&gt;</span> <span class="org-type">void</span> <span class="org-function-name">register_ctor</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">CtorDatabase</span>&amp;  <span class="org-variable-name">db</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    db<span class="org-rainbow-delimiters-depth-2">[</span>type<span class="org-rainbow-delimiters-depth-2">]</span> = <span class="org-rainbow-delimiters-depth-2">[](</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span><span class="org-rainbow-delimiters-depth-2">){</span> <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-3">(</span>parent<span class="org-rainbow-delimiters-depth-3">)</span>; <span class="org-rainbow-delimiters-depth-2">}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Create an object of a QWidget given class, given its name </span>
<span class="org-type">EXPORT_C</span> 
<span class="org-type">QWidget</span>* <span class="org-function-name">qt_widget_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">'static' =&gt; Initialize static object only once. </span>
    <span class="org-keyword">static</span> <span class="org-keyword">const</span> <span class="org-type">CtorDatabase</span> <span class="org-variable-name">ctordb</span> = <span class="org-rainbow-delimiters-depth-2">[]{</span>
        <span class="org-keyword">auto</span> db = CtorDatabase<span class="org-rainbow-delimiters-depth-3">{}</span>;
        register_ctor<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QWidget</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>db,        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::Window<span class="org-rainbow-delimiters-depth-3">)</span>;
        register_ctor<span class="org-rainbow-delimiters-depth-3">&lt;</span>QPushButton<span class="org-rainbow-delimiters-depth-3">&gt;(</span>db,    <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::QPushButton<span class="org-rainbow-delimiters-depth-3">)</span>;
        register_ctor<span class="org-rainbow-delimiters-depth-3">&lt;</span>QLabel<span class="org-rainbow-delimiters-depth-3">&gt;(</span>db,         <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::QLabel<span class="org-rainbow-delimiters-depth-3">)</span>;
        register_ctor<span class="org-rainbow-delimiters-depth-3">&lt;</span>QLineEdit<span class="org-rainbow-delimiters-depth-3">&gt;(</span>db,      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::QLineEdit<span class="org-rainbow-delimiters-depth-3">)</span>;
        register_ctor<span class="org-rainbow-delimiters-depth-3">&lt;</span>QDoubleSpinBox<span class="org-rainbow-delimiters-depth-3">&gt;(</span>db, <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::QDoubleSpinBox<span class="org-rainbow-delimiters-depth-3">)</span>;

        db<span class="org-rainbow-delimiters-depth-3">[</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-type">int</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-constant">WidgetType</span>::Window_main<span class="org-rainbow-delimiters-depth-3">]</span> = <span class="org-rainbow-delimiters-depth-3">[](</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span><span class="org-rainbow-delimiters-depth-3">){</span>
            <span class="org-type">QWidget</span>* <span class="org-variable-name">w</span> = <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-type">QWidget</span><span class="org-rainbow-delimiters-depth-4">(</span>parent<span class="org-rainbow-delimiters-depth-4">)</span>;
            w-&gt;resize<span class="org-rainbow-delimiters-depth-4">(</span>500, 400<span class="org-rainbow-delimiters-depth-4">)</span>;        
            w-&gt;setWindowTitle<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"MainWindow"</span><span class="org-rainbow-delimiters-depth-4">)</span>;
            w-&gt;show<span class="org-rainbow-delimiters-depth-4">()</span>;
            <span class="org-keyword">return</span> w;
        <span class="org-rainbow-delimiters-depth-3">}</span>;
        <span class="org-keyword">return</span> db;
    <span class="org-rainbow-delimiters-depth-2">}()</span>;

    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">auto</span> <span class="org-variable-name">it</span> = ctordb.find<span class="org-rainbow-delimiters-depth-3">(</span>type<span class="org-rainbow-delimiters-depth-3">)</span>; it != ctordb.end<span class="org-rainbow-delimiters-depth-3">()</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>  <span class="org-keyword">return</span> it-&gt;second<span class="org-rainbow-delimiters-depth-3">(</span>parent<span class="org-rainbow-delimiters-depth-3">)</span>;  <span class="org-rainbow-delimiters-depth-2">}</span>    
    <span class="org-keyword">return</span> <span class="org-constant">nullptr</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">QWidget</span>* <span class="org-function-name">qt_window_main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">QWidget</span>* <span class="org-variable-name">w</span> = <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">QWidget</span><span class="org-rainbow-delimiters-depth-2">{}</span>;
    w-&gt;resize<span class="org-rainbow-delimiters-depth-2">(</span>500, 400<span class="org-rainbow-delimiters-depth-2">)</span>;        
    w-&gt;setWindowTitle<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"MainWindow"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    w-&gt;show<span class="org-rainbow-delimiters-depth-2">()</span>;
    <span class="org-keyword">return</span> w; 
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">QLayout</span>* <span class="org-function-name">qt_layout_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == 1<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">QVBoxLayout</span><span class="org-rainbow-delimiters-depth-2">(</span>parent<span class="org-rainbow-delimiters-depth-2">)</span>;    
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == 2<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">QHBoxLayout</span><span class="org-rainbow-delimiters-depth-2">(</span>parent<span class="org-rainbow-delimiters-depth-2">)</span>;    
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>type == 3<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">std</span>::nothrow<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">QFormLayout</span><span class="org-rainbow-delimiters-depth-2">(</span>parent<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> <span class="org-constant">nullptr</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">QObject</span>* <span class="org-function-name">qt_QFormLayout_addWidgetAndLabel</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">QWidget</span>* <span class="org-variable-name">wdg</span> = qt_widget_new<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">nullptr</span>, type<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>wdg == <span class="org-constant">nullptr</span><span class="org-rainbow-delimiters-depth-2">){</span> <span class="org-keyword">return</span> <span class="org-constant">nullptr</span>; <span class="org-rainbow-delimiters-depth-2">}</span>
    self-&gt;addRow<span class="org-rainbow-delimiters-depth-2">(</span>label, wdg<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> wdg;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_QFormLayout_addRowItem</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-type">QWidget</span>* <span class="org-variable-name">field</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    self-&gt;addRow<span class="org-rainbow-delimiters-depth-2">(</span>field<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-type">EXPORT_C</span> 
<span class="org-type">QLabel</span>* <span class="org-function-name">qt_QFormLayout_addLabel1</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label_text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">btn</span> = <span class="org-keyword">new</span> <span class="org-type">QLabel</span><span class="org-rainbow-delimiters-depth-2">(</span>label_text<span class="org-rainbow-delimiters-depth-2">)</span>;
    self-&gt;addRow<span class="org-rainbow-delimiters-depth-2">(</span>btn<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> btn;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-type">EXPORT_C</span> 
<span class="org-type">QApplication</span>* <span class="org-function-name">qt_app_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>   
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Create QAppliction Object Ok"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">QApplication</span><span class="org-rainbow-delimiters-depth-2">(</span>argc, argv<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">QApplication</span>* <span class="org-function-name">qt_app_new2</span><span class="org-rainbow-delimiters-depth-1">()</span>   
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">std</span>::cout &lt;&lt; <span class="org-string">" [TRACE] Create QAppliction Object Ok"</span> &lt;&lt; <span class="org-constant">std</span>::endl;
    <span class="org-keyword">static</span> <span class="org-type">int</span>   <span class="org-variable-name">argc</span> = 1;
    <span class="org-keyword">static</span> <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">argv</span> <span class="org-rainbow-delimiters-depth-2">[]</span> = <span class="org-rainbow-delimiters-depth-2">{</span> <span class="org-string">"dummy_app"</span> <span class="org-rainbow-delimiters-depth-2">}</span>;    
    <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">QApplication</span><span class="org-rainbow-delimiters-depth-2">(</span>argc, <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">char</span>**<span class="org-rainbow-delimiters-depth-3">)</span> argv<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">int</span> <span class="org-function-name">qt_app_exec</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QApplication</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> self-&gt;exec<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">-------- Wrappers for QWidget Class ------------------//</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_widget_show</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    self-&gt;show<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">template</span><span class="org-rainbow-delimiters-depth-1">&lt;</span><span class="org-keyword">typename</span> <span class="org-type">T</span><span class="org-rainbow-delimiters-depth-1">&gt;</span>
<span class="org-keyword">static</span> <span class="org-type">bool</span> <span class="org-function-name">set_text</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">obj</span> = qobject_cast<span class="org-rainbow-delimiters-depth-2">&lt;</span><span class="org-type">T</span><span class="org-rainbow-delimiters-depth-2">&gt;(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">Early return on Error. </span>
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>obj == <span class="org-constant">nullptr</span> <span class="org-rainbow-delimiters-depth-2">){</span> <span class="org-keyword">return</span> <span class="org-constant">false</span>;  <span class="org-rainbow-delimiters-depth-2">}</span>    
    obj-&gt;setText<span class="org-rainbow-delimiters-depth-2">(</span>text<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">return</span> <span class="org-constant">true</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_widget_setText</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>        
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> set_text<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QLabel</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>self, text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>           <span class="org-keyword">return</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> set_text<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QLineEdit</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>self, text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>        <span class="org-keyword">return</span>;
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> set_text<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QTextEdit</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>self, text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>        <span class="org-keyword">return</span>; 
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> set_text<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QMessageBox</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>self, text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>      <span class="org-keyword">return</span>; 
    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span> set_text<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">QAbstractButton</span>*<span class="org-rainbow-delimiters-depth-3">&gt;(</span>self, text<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-keyword">return</span>;    
    <span class="org-comment-delimiter">// </span><span class="org-comment">logger().log() &lt;&lt; " [TRACE] Called function " &lt;&lt; __FUNCTION__ &lt;&lt; std::endl;</span>
    self-&gt;setWindowTitle<span class="org-rainbow-delimiters-depth-2">(</span>text<span class="org-rainbow-delimiters-depth-2">)</span>;  
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-comment-delimiter">// </span><span class="org-comment">-------- Wrappers for QPushButton Class ------------------//</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Install event handler (callback) for button clicked event </span>
<span class="org-type">EXPORT_C</span>
<span class="org-type">void</span> <span class="org-function-name">qt_button_onClicked</span><span class="org-rainbow-delimiters-depth-1">(</span>  <span class="org-comment-delimiter">// </span><span class="org-comment">Pointer to button </span>
                           <span class="org-type">QAbstractButton</span>* <span class="org-variable-name">self</span>
                           <span class="org-comment-delimiter">// </span><span class="org-comment">Context of the callback. Note: C does not support closures </span>
                           <span class="org-comment-delimiter">// </span><span class="org-comment">or stateful function pointer. All data needs to be passed </span>
                           <span class="org-comment-delimiter">// </span><span class="org-comment">as arguments</span>
                         , <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>
                           <span class="org-comment-delimiter">// </span><span class="org-comment">Pointer to callback function pointer. </span>
                         , <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>* <span class="org-function-name">callback</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">QObject</span>::connect<span class="org-rainbow-delimiters-depth-2">(</span>self, &amp;<span class="org-constant">QPushButton</span>::clicked, <span class="org-rainbow-delimiters-depth-3">[</span>=<span class="org-rainbow-delimiters-depth-3">]{</span>
        callback<span class="org-rainbow-delimiters-depth-4">(</span>ctx<span class="org-rainbow-delimiters-depth-4">)</span>;
    <span class="org-rainbow-delimiters-depth-3">}</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-comment-delimiter">// </span><span class="org-comment">Install event handler for </span>
<span class="org-type">EXPORT_C</span>
<span class="org-type">void</span> <span class="org-function-name">qt_QLineEdit_onTextChanged</span><span class="org-rainbow-delimiters-depth-1">(</span>  <span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span>
                                , <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>
                                , <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>* <span class="org-function-name">callback</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span>, <span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">QObject</span>::connect<span class="org-rainbow-delimiters-depth-2">(</span>self, &amp;<span class="org-constant">QLineEdit</span>::textChanged, <span class="org-rainbow-delimiters-depth-3">[</span>=<span class="org-rainbow-delimiters-depth-3">]{</span>
        callback<span class="org-rainbow-delimiters-depth-4">(</span>ctx, self<span class="org-rainbow-delimiters-depth-4">)</span>;
    <span class="org-rainbow-delimiters-depth-3">}</span><span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_msgbox_info</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">title</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">QMessageBox</span>::information<span class="org-rainbow-delimiters-depth-2">(</span>parent, title, text<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">Note: The string has to be released after with free() function.</span>
<span class="org-type">EXPORT_C</span>
<span class="org-keyword">const</span> <span class="org-type">char</span>* qt_QLineEdit_text<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> self-&gt;text<span class="org-rainbow-delimiters-depth-2">()</span>.toLocal8Bit<span class="org-rainbow-delimiters-depth-2">()</span>.constData<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">double</span> <span class="org-function-name">qt_QDoubleSpinBox_value</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QDoubleSpinBox</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">return</span> self-&gt;value<span class="org-rainbow-delimiters-depth-2">()</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_QDoubleSpinBox_setValue</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QDoubleSpinBox</span>* <span class="org-variable-name">self</span>, <span class="org-type">double</span> <span class="org-variable-name">value</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    self-&gt;setValue<span class="org-rainbow-delimiters-depth-2">(</span>value<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">EXPORT_C</span> 
<span class="org-type">void</span> <span class="org-function-name">qt_QDoubleSpinBox_onValueChanged</span><span class="org-rainbow-delimiters-depth-1">(</span> 
     <span class="org-type">QDoubleSpinBox</span>* <span class="org-variable-name">self</span>
   , <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>
   , <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>* <span class="org-function-name">callback</span><span class="org-rainbow-delimiters-depth-2">)(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-constant">QObject</span>::connect<span class="org-rainbow-delimiters-depth-2">(</span>  self, qOverload<span class="org-rainbow-delimiters-depth-3">&lt;</span><span class="org-type">double</span><span class="org-rainbow-delimiters-depth-3">&gt;(</span>&amp;<span class="org-constant">QDoubleSpinBox</span>::valueChanged<span class="org-rainbow-delimiters-depth-3">)</span>
                     , <span class="org-rainbow-delimiters-depth-3">[</span>=<span class="org-rainbow-delimiters-depth-3">](</span><span class="org-type">double</span> <span class="org-variable-name">x</span><span class="org-rainbow-delimiters-depth-3">){</span> callback<span class="org-rainbow-delimiters-depth-4">(</span>ctx<span class="org-rainbow-delimiters-depth-4">)</span>;  <span class="org-rainbow-delimiters-depth-3">}</span>
                    <span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
File: <span class="underline">qtwrapper.h</span> (header for the C-wrapper or C-interface)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-comment-delimiter">// </span><span class="org-comment">Non standard directive, but supported by most compiler to includer the</span>
<span class="org-comment-delimiter">// </span><span class="org-comment">header only once</span>
<span class="org-preprocessor">#pragma</span> once

<span class="org-comment-delimiter">// </span><span class="org-comment">Type aliases</span>
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">ANY</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QObject</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QApplication</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QPushButton</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QWidget</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QAbstractButton</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QLineEdit</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QLayout</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QFormLayout</span>;
<span class="org-keyword">typedef</span> <span class="org-type">void</span>   <span class="org-type">QLabel</span>;

<span class="org-type">void</span> <span class="org-function-name">qt_qobject_del</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_dumpObjectInfo</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_dumpObjectTree</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span> <span class="org-function-name">qt_qobject_print</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-type">QApplication</span>* <span class="org-function-name">qt_app_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">QApplication</span>* <span class="org-function-name">qt_app_new2</span><span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Instantiate any QT widget by name</span>
<span class="org-type">QWidget</span>* <span class="org-function-name">qt_widget_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">void</span> <span class="org-function-name">qt_widget_setText</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">QApplication</span>
<span class="org-type">int</span>  <span class="org-function-name">qt_app_exec</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QApplication</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Any QtWidget</span>
<span class="org-type">void</span>          <span class="org-function-name">qt_QWidget_show</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span>          <span class="org-function-name">qt_QWidget_setToolTip</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">tooltip</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">QPushButton wrappers</span>
<span class="org-type">QPushButton</span>*  <span class="org-function-name">qt_QPushButton_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span>          <span class="org-function-name">qt_QPushButton_onClicked_test</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QPushButton</span>* <span class="org-variable-name">self</span> <span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">Abstract PushbButton</span>
<span class="org-type">void</span>          <span class="org-function-name">qt_button_onClicked</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QAbstractButton</span>* <span class="org-variable-name">self</span>, <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>, <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>* <span class="org-function-name">callback</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">void</span>*<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">void</span>          <span class="org-function-name">qt_button_setText</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QAbstractButton</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-keyword">const</span> <span class="org-type">char</span>*   <span class="org-function-name">qt_QLineEdit_text</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">QLayout</span>*     <span class="org-function-name">qt_layout_new</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">QObject</span>*     <span class="org-function-name">qt_QFormLayout_addWidgetAndLabel</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">QLabel</span>* <span class="org-function-name">qt_QFormLayout_addLabel1</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label_text</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">void</span> <span class="org-function-name">qt_msgbox_info</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">title</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">void</span> <span class="org-function-name">qt_QLineEdit_onTextChanged</span><span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span>
                               , <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>
                               , <span class="org-type">void</span> <span class="org-rainbow-delimiters-depth-2">(</span>* <span class="org-function-name">callback</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span>, <span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<p>
<b>Considerations:</b>
</p>

<ol class="org-ol">
<li><span class="underline">(extern "C")</span> enforces C linkage, in other words, the function with
this annotation must have a C compatible signature and use C
compatible types.</li>

<li>The C++ operator <span class="underline">new</span> throws exception when there is not enough
memory, it throws std::bad_alloc. As C does not support
exceptions, it is necessary to use the operator <span class="underline">new (std::nothrow)</span> that 
returns null pointer instead of throwing an exception.</li>

<li>Due to the lack of C support for exceptions, any exception throw
in the functions annotated with extern "C" should be returned as
as an additional function parameter. Moreover, C++ exceptions are
from different compilers may not even be compatible due to the
lack of standard C++ ABI.</li>

<li>As C functions does not support closures, they cannot keep state,
therefore it is necessary to add an extra void pointer parameter
(void*) in the function pointers arguments and in the functions
that takes them as parameters such as,
<span class="underline">qt_button_onClicked()</span>. This additional (void*) pointer allows the
calling code to pass and keep state.</li>

<li>Despite that this technique, for creating a C-wrapper (C
interface), was used for Qt5 Widgets library, this approach can
be used for any other C++ library such as: Boost-Libraries,
WxWidgets GUI library, Windows MFC (Microsoft Foundation Classes)
and so on.</li>

<li>This C-wrapper technique can also be used for creating
C-libraries in C++, which can be loaded from any programming
languages (Python, Ruby, Lisp, &#x2026;) via FFI (Foreign Function
Interface) or by linking against the C-wrapper shared library in
the case of compiled language such as Golang, Rust or
D-lang.</li>

<li>If Qt had C-binding similar to this one, shipped with Qt on every
Linux distribution that uses Qt or KDE, it would be possible to
create Qt applications in any other programming language than
C++, by loading the C-binding via FFI foreign function interface
or by linking against the C-binding if the programming language
is compiled and supports linking against C ABI (Application
Binary Interface).</li>

<li>Another benefit of a C-wrapper for C++ libraries is that a
C-wrapper  provides a stable ABI (Application-Binary Interface)
which allows an application built with different C++ compiler to
link against the library C-interface without any library
recompilation and avoiding compiling the library with all
possible C++ compilers that a client-code can possibly use.</li>

<li>An alternative method for accessing the C++ libraries from higher
level languages is by using <a href="http://www.swig.org/">SWIG</a> (SWIG wrapper generator), which
parses interface files and library header files for generating
C-code for programming language-specific <span class="underline">native interface API</span>,
which allows creating native code libraries in C that are loaded
at runtime via dlopen() calls, on Unix-like systems, or
LoadLibrary() calls on Windows. The terminology <span class="underline">native-interface</span>
<span class="underline">API</span> was borrowed from Java's JNI (Java Native Interface API) as
unlike FFI (Foreign Function Interfaces), there is a lack of
proper terminology for describing this feature. For instance, the
Pythons' native interface API allows creating Python modules (aka
libraries) entirely in C. The disadvantage of using SWIG is that,
it requires access to the library source code and compilation of 
generated binding code for every programming language that
binding will be generated for while a C-wrapper needs compilation
only once.</li>
</ol>
</div>
</div>
<div id="outline-container-org308a7b2" class="outline-4">
<h4 id="org308a7b2"><span class="section-number-4">1.3.3</span> Building the wrapper file.</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
Note: this code was compiled and tested on a Linux - Fedora 32, 64
bits machine which contains pre-installed Qt5 libraries.
</p>

<p>
Fetch the sources:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ git clone https://gist.github.com/a59d0f1b17d286dad19842932c931e92 qt5-cwrapper
$ cd qt5-cwrapper

$ ls
client1.c  CMakeLists.txt  d_client.d  loader.jl  qtwrapper.cpp  qtwrapper.h
</pre>
</div>

<p>
Build the project: (Note: Tested on Linux Fedora-32 64 bits x86-64)
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cmake --config Debug -H. -Bbuild
$ cmake --build build --target
</pre>
</div>

<p>
Check binaries:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ file build/client1
<span class="org-function-name">build/client1</span>: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2
, <span class="org-variable-name">BuildID</span>[sha1]=122650693cf9845a35afeb76bced113f3d92ed1a, for GNU/Linux 3.2.0, not stripped

$ file build/libqtwrapper.so
<span class="org-function-name">build/libqtwrapper.so</span>: ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), statically linked
, <span class="org-variable-name">BuildID</span>[sha1]=47381d2f687f8cb5f6bf80be737c0baa2b0e2cb1, not stripped
</pre>
</div>

<p>
Show symbols exported by the C-wrapper shared library:
</p>
<ul class="org-ul">
<li>Note: On windows, the equivalent tool is <span class="underline">dumpbin</span> and on MacOSX,
the equivalent tool is <span class="underline">otool</span>.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">$ nm -D build/libqtwrapper.so 
  ... ... ... ... ... ... ... 
  ... ... ... ... ... ... ... 
0000000000012d9d T qt_QFormLayout_addRowItem
0000000000012d0c T qt_QFormLayout_addWidgetAndLabel
000000000001315a T qt_QLineEdit_onTextChanged
0000000000013284 T qt_QLineEdit_text
0000000000012741 T qt_qobject_ClassName
000000000001271a T qt_qobject_del
000000000001276a T qt_qobject_dumpObjectInfo
0000000000012785 T qt_qobject_dumpObjectTree
00000000000127a0 T qt_qobject_print
                 U qt_version_tag
0000000000012a47 T qt_widget_new
0000000000012fbb T qt_widget_setText
0000000000012fa0 T qt_widget_show
0000000000012b51 T qt_window_main
                 U strlen
                 U _Unwind_Resume
00000000000157a8 W _Z12qobject_castIP11QMessageBoxET_P7QObject
00000000000157cc W _Z12qobject_castIP15QAbstractButtonET_P7QObject
000000000001573c W _Z12qobject_castIP6QLabelET_P7QObject
0000000000015760 W _Z12qobject_castIP9QLineEditET_P7QObject
  ... ... ... ... ... ... ... ... 
  ... ... ... ... ... ... ... ... 
</pre>
</div>

<p>
Show exported symbols demangling (aka decoding) C++ mangled symbols: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; nm -D build/libqtwrapper.so | c++filt
 ... ... ... ... ... 
 ... ... ... ... ... 
000000000001276a T qt_qobject_dumpObjectInfo
0000000000012785 T qt_qobject_dumpObjectTree
00000000000127a0 T qt_qobject_print
                 U qt_version_tag
0000000000012a47 T qt_widget_new
0000000000012fbb T qt_widget_setText
0000000000012fa0 T qt_widget_show
0000000000012b51 T qt_window_main
                 U strlen
                 U _Unwind_Resume
00000000000157a8 W QMessageBox* qobject_cast&lt;QMessageBox*&gt;(QObject*)
00000000000157cc W QAbstractButton* qobject_cast&lt;QAbstractButton*&gt;(QObject*)
000000000001573c W QLabel* qobject_cast&lt;QLabel*&gt;(QObject*)
0000000000015760 W QLineEdit* qobject_cast&lt;QLineEdit*&gt;(QObject*)
   ... ... ... ... ... 
 ... ... ... ... ... 
</pre>
</div>
</div>
</div>

<div id="outline-container-org52a34f7" class="outline-4">
<h4 id="org52a34f7"><span class="section-number-4">1.3.4</span> C client code</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
File: <span class="underline">client1.c</span> (C-client code)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">stdio.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">stdlib.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>
<span class="org-preprocessor">#include</span> <span class="org-string"><span class="org-rainbow-delimiters-depth-1">&lt;</span></span><span class="org-string">assert.h</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">&gt;</span></span>

<span class="org-preprocessor">#include</span> <span class="org-string">"qtwrapper.h"</span>

<span class="org-keyword">typedef</span> <span class="org-keyword">struct</span> <span class="org-type">CallbackContext</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">QLineEdit</span>* <span class="org-variable-name">lin</span>;
    <span class="org-type">int</span>        <span class="org-variable-name">counter</span>;
<span class="org-rainbow-delimiters-depth-1">}</span> <span class="org-type">CallbackContext</span>;


<span class="org-comment-delimiter">// </span><span class="org-comment">All callback (closure) state should be passed as arguments</span>
<span class="org-type">void</span> <span class="org-function-name">onclicked_callback</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">context</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">CallbackContext</span>* <span class="org-variable-name">ctx</span> = <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">CallbackContext</span>*<span class="org-rainbow-delimiters-depth-2">)</span> context;
    ctx-&gt;counter += 1;
    <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">str</span> = qt_QLineEdit_text<span class="org-rainbow-delimiters-depth-2">(</span>ctx-&gt;lin<span class="org-rainbow-delimiters-depth-2">)</span>;

    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [TRACE] Button clicked =&gt; Counter incremented to: %d \n"</span>, ctx-&gt;counter<span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [TRACE] QLineEdit Value = %s \n"</span>, str<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">free(str);</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">qt_msgbox_info(NULL, "Message Info", "Button clicked Ok");</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">lineEdit_Callback</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span>, <span class="org-type">QLineEdit</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">str</span> = qt_QLineEdit_text<span class="org-rainbow-delimiters-depth-2">(</span>self<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">QLabel</span>*   <span class="org-variable-name">label</span> = <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">QLabel</span>*<span class="org-rainbow-delimiters-depth-2">)</span> ctx;
    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>label, str<span class="org-rainbow-delimiters-depth-2">)</span>;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [LineEdit Callback] Text changed to %s \n"</span>, str<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">void</span> <span class="org-function-name">onclick_msgbox_callback</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">context</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">QLineEdit</span>* <span class="org-variable-name">lin</span> = <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">QLineEdit</span>*<span class="org-rainbow-delimiters-depth-2">)</span> context;
    <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">str</span> = qt_QLineEdit_text<span class="org-rainbow-delimiters-depth-2">(</span>lin<span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_msgbox_info<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">NULL</span>, <span class="org-string">"Message Info"</span>, str<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">free(str);</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_WINDOW</span>           = 1;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_WINDOW_MAIN</span>      = 2;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QPUSH_BUTTON</span>     = 3;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QLABEL</span>           = 4;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QLINE_EDIT</span>       = 5;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QDOUBLE_SPINBOX</span>  = 6;

<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">LAYOUT_QFORM_LAYOUT</span> = 3;

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span>** <span class="org-variable-name">argv</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">QApplication* qapp = qt_app_new(argc, argv);</span>
    <span class="org-type">QApplication</span>* <span class="org-variable-name">qapp</span> = qt_app_new2<span class="org-rainbow-delimiters-depth-2">()</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">-------- Create GUI - Graphical User Interface ------//</span>

    <span class="org-type">QPushButton</span>* <span class="org-variable-name">win</span> = qt_widget_new<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">NULL</span>, WIDGET_WINDOW_MAIN<span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>win, <span class="org-string">"Window Title"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    assert<span class="org-rainbow-delimiters-depth-2">(</span>win != <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">QFormLayout</span>* <span class="org-variable-name">form</span> = qt_layout_new<span class="org-rainbow-delimiters-depth-2">(</span>win, LAYOUT_QFORM_LAYOUT<span class="org-rainbow-delimiters-depth-2">)</span>;
    assert<span class="org-rainbow-delimiters-depth-2">(</span>form != <span class="org-constant">NULL</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">QLineEdit</span>*   <span class="org-variable-name">lin</span>  = qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QLINE_EDIT,   <span class="org-string">"Input"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">QPushButton</span>* <span class="org-variable-name">btn1</span> = qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QPUSH_BUTTON, <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">QPushButton</span>* <span class="org-variable-name">btn2</span> = qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QPUSH_BUTTON, <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">QLabel</span>*      <span class="org-variable-name">disp</span> = qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QLABEL,       <span class="org-string">"Display label"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>btn1, <span class="org-string">"Button 1"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>btn2 ,<span class="org-string">"Button 2"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-comment-delimiter">// </span><span class="org-comment">qt_widget_setToolTip(btn1, "Click at this button to play!");</span>

    qt_qobject_print<span class="org-rainbow-delimiters-depth-2">(</span>win<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">-------- Install Event Handlers --------------//</span>
    <span class="org-comment-delimiter">//</span>

    qt_QLineEdit_onTextChanged<span class="org-rainbow-delimiters-depth-2">(</span>lin, disp, lineEdit_Callback<span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_button_onClicked<span class="org-rainbow-delimiters-depth-2">(</span>btn1, lin, &amp;onclick_msgbox_callback<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">CallbackContext</span> <span class="org-variable-name">ctx</span>;
    ctx.counter = 0;
    ctx.lin = lin;
    qt_button_onClicked<span class="org-rainbow-delimiters-depth-2">(</span>btn2, &amp;ctx, &amp;onclicked_callback<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">---- Run QT event loop - blocking main thread  ---//</span>
    qt_app_exec<span class="org-rainbow-delimiters-depth-2">(</span>qapp<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">----- Dispose objects ---------------------------//</span>
    qt_qobject_del<span class="org-rainbow-delimiters-depth-2">(</span>win<span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_qobject_del<span class="org-rainbow-delimiters-depth-2">(</span>qapp<span class="org-rainbow-delimiters-depth-2">)</span>;

    puts<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"\n [TRACE] Terminate application Ok. "</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>

<p>
Run executable: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ build/client1
 [TRACE] Create QAppliction Object Ok
 [LineEdit Callback] Text changed to h 
 [LineEdit Callback] Text changed to h 
 [LineEdit Callback] Text changed to h 
 [LineEdit Callback] Text changed to h 
 ...  ...  ...  ...  ...  ... 
 ...  ...  ...  ...  ...  ...  ... 
</pre>
</div>

<p>
User Interface Screenshot: 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-1.png"><img src="images/cwrapper-qt5-1.png" alt="cwrapper-qt5-1.png" /></a> 
</p>
<p><span class="figure-number">Figure 1: </span>User interface for C client code.</p>
</div>
</div>
</div>
<div id="outline-container-org74f6390" class="outline-4">
<h4 id="org74f6390"><span class="section-number-4">1.3.5</span> Python3 Client Code</h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
The following python script, loads the C shared library wrapper for
Qt5 widgets using Python3 ctypes FFI (Foreign Function
Interface). Although, Python3 already has <a href="https://wiki.python.org/moin/PyQt">PyQt</a> and <a href="https://wiki.qt.io/Qt_for_Python">Pyside2</a> library
bindings what make this code seems pointless, the objective of this
code is to be a proof-of-concept about how to load C++ libraries via
FFI (Foreign Function Interface).
</p>

<p>
<b>Files:</b>
</p>

<p>
File: <span class="underline">pywrapper.py</span> 
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/env python3</span>
<span class="org-keyword">import</span> ctypes 
<span class="org-keyword">from</span> ctypes <span class="org-keyword">import</span> (c_int, c_int, c_char, c_void_p)

<span class="org-comment-delimiter"># </span><span class="org-comment">===== Aliases for making life easier ===========#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">-------------------------------------------------#</span>

<span class="org-variable-name">c_void</span>  = <span class="org-constant">None</span>                         <span class="org-comment-delimiter"># </span><span class="org-comment">void </span>
<span class="org-variable-name">c_pconst_char</span> = ctypes.POINTER(c_char) <span class="org-comment-delimiter"># </span><span class="org-comment">const char* </span>
<span class="org-variable-name">c_pnull</span> = c_void_p(0)                  <span class="org-comment-delimiter"># </span><span class="org-comment">Null pointer </span>
<span class="org-variable-name">QObject</span> = c_void_p                     <span class="org-comment-delimiter"># </span><span class="org-comment">void* - void pointer </span>
<span class="org-variable-name">Qapp</span>    = c_void_p 
<span class="org-variable-name">QWidget</span> = c_void_p
<span class="org-variable-name">QLayout</span> = c_void_p 

<span class="org-comment-delimiter">#  </span><span class="org-comment">=========== Load shared library ================#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">--------------------------------------------------#</span>

<span class="org-comment-delimiter">#  </span><span class="org-comment">Arguments of: ctypes.cdll.LoadLibrary(&lt;LIBRARY&gt;)</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">On Linux, the operating system linker looks for</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">the library at directories listed in $LD_LIBRARY_PATH</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">environment variable or in default set of directories </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">such as /lib, /usr/lib and so on. </span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">On Windows, the operating system looks for the library </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">in C:\\Windows\System32 directory or in directories</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">listed in %PATH% environment variable.</span>
<span class="org-comment-delimiter"># </span>
<span class="org-comment-delimiter"># </span><span class="org-comment">The argument of LoadLibrary() can also be the absolute</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">path to the shared library. </span>
<span class="org-comment-delimiter">#</span>

<span class="org-variable-name">lib</span> = ctypes.cdll.LoadLibrary(<span class="org-string">"libqtwrapper.so"</span>)

<span class="org-comment-delimiter">#</span><span class="org-comment">======= Set types of C subroutines ===================#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">------------------------------------------------------#</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">-- Note: There is no keyword const in Python</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">it is assumed that the user or calling code</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">will never modify the following definitions. </span>
<span class="org-variable-name">WIDGET_WINDOW</span>          = 0
<span class="org-variable-name">WIDGET_WINDOW_MAIN</span>     = 2
<span class="org-variable-name">WIDGET_QPUSH_BUTTON</span>    = 3
<span class="org-variable-name">WIDGET_QLABEL</span>          = 4
<span class="org-variable-name">WIDGET_QLINE_EDIT</span>      = 5
<span class="org-variable-name">WIDGET_QDOUBLE_SPINBOX</span> = 6
<span class="org-variable-name">LAYOUT_QFORM_LAYOUT</span>    = 3

<span class="org-variable-name">lib.qt_app_new2.argtypes</span> = []
<span class="org-variable-name">lib.qt_app_new2.restype</span>  = Qapp 

<span class="org-variable-name">lib.qt_app_exec.argtypes</span> = [ Qapp ]
<span class="org-variable-name">lib.qt_app_exec.restype</span>  = c_void

<span class="org-variable-name">lib.qt_qobject_del.argtypes</span> = [ QObject ]
<span class="org-variable-name">lib.qt_qobject_del.restype</span>  = c_void

<span class="org-variable-name">lib.qt_window_main.argtypes</span> = []
<span class="org-variable-name">lib.qt_window_main.restype</span>  = QWidget

<span class="org-variable-name">lib.qt_widget_setText.argtypes</span> = [ QWidget, c_pconst_char  ]
<span class="org-variable-name">lib.qt_widget_setText.restype</span>  = c_void 

<span class="org-variable-name">lib.qt_layout_new.argytpes</span> = [ QWidget, c_int ]
<span class="org-variable-name">lib.qt_layout_new.restype</span>  = QLayout

<span class="org-variable-name">lib.qt_msgbox_info.argtypes</span> = [ QWidget, c_pconst_char, c_pconst_char ]
<span class="org-variable-name">lib.qt_msgbox_info.restype</span> = c_void

<span class="org-variable-name">lib.qt_QFormLayout_addWidgetAndLabel.argtypes</span> = [QWidget, c_int, c_pconst_char ]
<span class="org-variable-name">lib.qt_QFormLayout_addWidgetAndLabel.restype</span>  = QWidget

<span class="org-comment-delimiter"># </span><span class="org-comment">Callback type: </span>
<span class="org-variable-name">FnButtonCallback</span> = ctypes.CFUNCTYPE(  c_void    <span class="org-comment-delimiter"># </span><span class="org-comment">Return tupe </span>
                                    , c_void_p  <span class="org-comment-delimiter"># </span><span class="org-comment">Type of first parameter (void*)</span>
                                    )

<span class="org-variable-name">lib.qt_button_onClicked.argtypes</span> = [ QWidget, c_void_p, FnButtonCallback ]
<span class="org-variable-name">lib.qt_button_onClicked.restype</span>  = c_void 

<span class="org-comment-delimiter">#</span><span class="org-comment">===== Create the Qt5 Widgets - GUI - Graphics User ==========#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">-------------------------------------------------------------#</span>

<span class="org-variable-name">qapp</span> = lib.qt_app_new2()

<span class="org-variable-name">window</span> = lib.qt_window_main()
lib.qt_widget_setText(window, <span class="org-string">"Qt5 Widgets Window from Python3 FFI"</span>.encode(<span class="org-string">"UTF-8"</span>))

<span class="org-variable-name">form</span> = lib.qt_layout_new(window, LAYOUT_QFORM_LAYOUT)

<span class="org-variable-name">label_output</span> = lib.qt_QFormLayout_addWidgetAndLabel(
                form, WIDGET_QLABEL, b<span class="org-string">"Result"</span> )

<span class="org-variable-name">btnA</span> = lib.qt_QFormLayout_addWidgetAndLabel(
                form, WIDGET_QPUSH_BUTTON, b<span class="org-string">"Label A"</span> )

lib.qt_widget_setText(btnA, <span class="org-string">"Button A"</span>.encode(<span class="org-string">"UTF-8"</span>) )

<span class="org-variable-name">btnB</span> = lib.qt_QFormLayout_addWidgetAndLabel(
                 form, WIDGET_QPUSH_BUTTON, b<span class="org-string">"Label B"</span>)

lib.qt_widget_setText(btnB, b<span class="org-string">"Button B"</span> )

<span class="org-variable-name">entry</span> = lib.qt_QFormLayout_addWidgetAndLabel(
                        form, WIDGET_QLINE_EDIT, b<span class="org-string">"Information:"</span>)

<span class="org-variable-name">spinbox</span> = lib.qt_QFormLayout_addWidgetAndLabel(
                   form, WIDGET_QDOUBLE_SPINBOX, b<span class="org-string">"Price:"</span>)


<span class="org-keyword">print</span>(<span class="org-string">" [PYTHON] Qt5 GUI Created Ok. "</span>)

<span class="org-comment-delimiter">#</span><span class="org-comment">===== Install callbacks (event handlers) ===================#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">------------------------------------------------------------#</span>

<span class="org-variable-name">counter</span> = 0

<span class="org-comment-delimiter"># </span><span class="org-comment">Note: Python lacks multi-line lambdas</span>
<span class="org-keyword">def</span> <span class="org-function-name">btnA_callback</span>(ctx: c_void_p) -&gt; c_void:
    <span class="org-keyword">global</span> counter 
    <span class="org-variable-name">counter</span> = counter + 1
    <span class="org-variable-name">text</span> = f<span class="org-string">" [PYTHON] Button A Clicked =&gt; Counter = {counter} "</span>
    <span class="org-variable-name">text</span> = text.encode(<span class="org-string">"UTF-8"</span>)
    <span class="org-keyword">print</span>(text)
    lib.qt_widget_setText(label_output, text)
    lib.qt_widget_setText(entry, text)    

<span class="org-variable-name">obj_btnA_callback</span> = FnButtonCallback(btnA_callback)
lib.qt_button_onClicked(btnA, c_pnull, obj_btnA_callback)

<span class="org-keyword">def</span> <span class="org-function-name">btnB_callback</span>(ctx: c_void_p) -&gt; c_void:
    <span class="org-keyword">global</span> counter
    <span class="org-variable-name">counter</span> = counter - 1
    <span class="org-variable-name">text</span> = f<span class="org-string">" [PYTHON] Button B Clicked =&gt; Counter = {counter} "</span>
    <span class="org-variable-name">text</span> = text.encode(<span class="org-string">"UTF-8"</span>)    
    <span class="org-keyword">print</span>(text)
    lib.qt_widget_setText(label_output, text)
    lib.qt_widget_setText(entry, text)        
    lib.qt_msgbox_info( window, b<span class="org-string">"Information:"</span>, text)

<span class="org-variable-name">obj_btnB_callback</span> = FnButtonCallback(btnB_callback)
lib.qt_button_onClicked(btnB, c_pnull, obj_btnB_callback)


<span class="org-comment-delimiter">#</span><span class="org-comment">====== Run QT event loop blocking current thread ============#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">-------------------------------------------------------------#</span>
<span class="org-keyword">print</span>(<span class="org-string">" [PYTHON] Running QT event loop =&gt; Main thread blocked!. "</span>)
lib.qt_app_exec(qapp)

<span class="org-comment-delimiter">#</span><span class="org-comment">===== Dispose C++ objects loaded via FFI =====================#</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">--------------------------------------------------------------#</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Note: Only the root object (wihout any parent element) needs</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">to be disposed (aka released from memory).</span>
lib.qt_qobject_del(window)

lib.qt_qobject_del(qapp)


<span class="org-keyword">print</span>(<span class="org-string">" [PYTHON] Application terminated gracefully. Ok. "</span>)

</pre>
</div>

<p>
<b>Running</b> 
</p>

<div class="org-src-container">
<pre class="src src-sh"> <span class="org-comment-delimiter"># </span><span class="org-comment">Directory where there are the *.so shared libraries files (shared objects)</span>
 $ export <span class="org-variable-name">LD_LIBRARY_PATH</span>=$<span class="org-variable-name">PWD</span>/_build 

 $ python3 pywrapper.py
 [TRACE] Create QAppliction Object Ok
 [PYTHON] Qt5 GUI Created Ok. 
 [PYTHON] Running QT event loop =&gt; Main thread blocked!. 
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 1 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 2 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 3 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 4 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 5 '</span>
.... ... ...   .... ... ...   .... ... ...   .... ... ... 
.... ... ...   .... ... ...   .... ... ...   .... ... ... 
b<span class="org-string">' [PYTHON] Button B Clicked =&gt; Counter = 9 '</span>
b<span class="org-string">' [PYTHON] Button B Clicked =&gt; Counter = 8 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 9 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 10 '</span>
b<span class="org-string">' [PYTHON] Button A Clicked =&gt; Counter = 11 '</span>
 [PYTHON] Application terminated gracefully. Ok. 
</pre>
</div>

<p>
Or:
</p>

<pre class="example">
$ env LD_LIBRARY_PATH=$PWD/_build python3 pywrapper.py
</pre>

<p>
Or:
</p>

<pre class="example">
$ chmod +x pywrapper.py 
$ env LD_LIBRARY_PATH=$PWD/_build ./pywrapper.py
</pre>

<p>
<b>Screenshot</b> 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-6.png"><img src="images/cwrapper-qt5-6.png" alt="cwrapper-qt5-6.png" /></a>
</p>
<p><span class="figure-number">Figure 2: </span>Python3 Ctypes FFI wrapper for lib qtwrapper shared library.</p>
</div>
</div>
</div>
<div id="outline-container-orgd987ed5" class="outline-4">
<h4 id="orgd987ed5"><span class="section-number-4">1.3.6</span> Julia Client Code (loader.jl)</h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
File: <span class="underline">loader.jl</span> (Julia language client code)
</p>

<div class="org-src-container">
<pre class="src src-julia"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/env julia</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Refers to file libqexport.so</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">On Linux:</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">It is assumed that the LD_LIBRARY_PATH environment variable of current</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">process contains the directory where libqtexport is located.</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">On Windows:</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">It is made the assumption that the PATH environmenrt variable of current</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">process contains the directory where libqtexport is located.</span>
<span class="org-comment-delimiter">#</span>
<span class="org-comment-delimiter">#</span>
<span class="org-keyword">const</span> shlib = <span class="org-string">"libqtwrapper"</span>

<span class="org-keyword">const</span> QObject = <span class="org-type">Ptr</span>{Cvoid}
<span class="org-keyword">const</span> QWidget = <span class="org-type">Ptr</span>{Cvoid}
<span class="org-keyword">const</span> QLayout = <span class="org-type">Ptr</span>{Cvoid}
<span class="org-keyword">const</span> QApp    = <span class="org-type">Ptr</span>{Cvoid}
<span class="org-keyword">const</span> QButton = <span class="org-type">Ptr</span>{Cvoid}
<span class="org-keyword">const</span> QDoubleSpinbox = <span class="org-type">Ptr</span>{Cvoid}

<span class="org-keyword">const</span> WIDGET_WINDOW           = 1;
<span class="org-keyword">const</span> WIDGET_WINDOW_MAIN      = 2;
<span class="org-keyword">const</span> WIDGET_QPUSH_BUTTON     = 3;
<span class="org-keyword">const</span> WIDGET_QLABEL           = 4;
<span class="org-keyword">const</span> WIDGET_QLINE_EDIT       = 5;
<span class="org-keyword">const</span> WIDGET_QDOUBLE_SPINBOX  = 6;
<span class="org-keyword">const</span> LAYOUT_QFORM_LAYOUT     = 3;


<span class="org-comment-delimiter"># </span><span class="org-comment">Wrapper to function:</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">QWidget* qt_widget_new(QWidget* parent, const char* name)</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_widget_new</span>(<span class="org-keyword">type</span><span class="org-default">::</span><span class="org-type">Int</span>)<span class="org-default">::</span><span class="org-type">QWidget</span>
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_widget_new</span>, shlib)
                  <span class="org-comment-delimiter"># </span><span class="org-comment">Function type signatrue</span>
                 , QWidget, (QWidget, <span class="org-type">Cint</span>)
                 <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments (parent = null and name = name)</span>
                 , <span class="org-constant">C_NULL</span>, <span class="org-keyword">type</span>
                 )
<span class="org-keyword">end</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Delete any instance of QObject (QWidget, QApplictation, QLayout) and so on</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_qobject_del</span>(obj<span class="org-default">::</span><span class="org-type">QObject</span>)
    <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_qobject_del</span>, shlib)
          , Cvoid, ( QObject, )
          , obj )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">qt_qobject_print</span>(self<span class="org-default">::</span><span class="org-type">QObject</span>)
    <span class="org-keyword">ccall</span>( (<span class="org-julia-quoted-symbol">:qt_qobject_print</span>, shlib)
          , Cvoid, (QObject,)
          , self )
<span class="org-keyword">end</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">=&gt; void qt_widget_setText(QWidget* self, const char* text);</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_widget_setText</span>(self<span class="org-default">::</span><span class="org-type">QWidget</span>, text<span class="org-default">::</span><span class="org-type">String</span>)
     <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_widget_setText</span>, shlib)
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function type signatrue</span>
            , Cvoid, (QWidget, Cstring)
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments (parent = null and name = name)</span>
            , self, text )
<span class="org-keyword">end</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">extern QLayout* qt_layout_new(QWidget* parent, const char* name);</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_layout_new</span>(<span class="org-keyword">type</span><span class="org-default">::</span><span class="org-type">Int</span>, parent<span class="org-default">::</span><span class="org-type">QWidget</span>)<span class="org-default">::</span><span class="org-type">QLayout</span>
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_layout_new</span>, shlib)
                  <span class="org-comment-delimiter"># </span><span class="org-comment">Function type signatrue</span>
                 , QLayout, (QWidget, <span class="org-type">Cint</span>)
                 <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments (parent = null and name = name)</span>
                 , parent, <span class="org-keyword">type</span> )
<span class="org-keyword">end</span>

<span class="org-comment-delimiter">#  </span><span class="org-comment">QPushButton* qt_QFormLayout_addButton(QFormLayout* self, const char* label)</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_QFormLayout_addWidgetAndLabel</span>(form<span class="org-default">::</span><span class="org-type">QLayout</span>, <span class="org-keyword">type</span><span class="org-default">::</span><span class="org-type">Int</span>, label<span class="org-default">::</span><span class="org-type">String</span>)<span class="org-default">::</span><span class="org-type">QWidget</span>
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_QFormLayout_addWidgetAndLabel</span>, shlib)
                 <span class="org-comment-delimiter"># </span><span class="org-comment">Function type signatrue</span>
                 , QWidget, (QLayout, <span class="org-type">Cint</span>, Cstring)
                 <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments</span>
                 , form, <span class="org-keyword">type</span>, label )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">qt_qobject_ClassName</span>(self<span class="org-default">::</span><span class="org-type">QObject</span>)<span class="org-default">::</span><span class="org-type">String</span>
    res = <span class="org-keyword">ccall</span>( (<span class="org-julia-quoted-symbol">:qt_qobject_ClassName</span>, shlib)
                 , Cstring, (QObject, )
                 , self )
    <span class="org-keyword">return</span> unsafe_string(res)
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">QApplication_new</span>()
    <span class="org-comment-delimiter"># </span><span class="org-comment">return ccall( (:qt_app_new2, shlib), Ptr{Cvoid}, ())</span>
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>((<span class="org-julia-quoted-symbol">:qt_app_new2</span>, shlib), QApp, ())
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">QApplication_exec</span>(self)
    <span class="org-keyword">ccall</span>((<span class="org-julia-quoted-symbol">:qt_app_exec</span>, shlib), Cvoid, ( QApp, ), self )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">QPushButton_new</span>(label<span class="org-default">::</span><span class="org-type">String</span>)
    <span class="org-comment-delimiter"># </span><span class="org-comment">return ccall((:qt_QPushButton_new, shlib), ( Ptr{Cvoid}, Cstring ), C_NULL, label )</span>
    <span class="org-keyword">return</span>  btn = <span class="org-keyword">ccall</span>( (<span class="org-julia-quoted-symbol">:qt_QPushButton_new</span>, shlib)
                        , <span class="org-type">Ptr</span>{Cvoid}, (<span class="org-type">Ptr</span>{Cvoid}, Cstring)
                        , <span class="org-constant">C_NULL</span>, label
                        )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">QWidget_show</span>(self)
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>((<span class="org-julia-quoted-symbol">:qt_QWidget_show</span>, shlib), Cvoid, ( <span class="org-type">Ptr</span>{Cvoid}, ), self)
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">QPushButton_onClicked_test</span>(self<span class="org-default">::</span><span class="org-type">QButton</span>)
    <span class="org-keyword">ccall</span>((<span class="org-julia-quoted-symbol">:qt_QPushButton_onClicked_test</span>, shlib), Cvoid, ( QButton, ), self)
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">qt_button_onClicked</span>(self<span class="org-default">::</span><span class="org-type">QButton</span>, handler)
    callback = <span class="org-julia-macro">@cfunction</span> <span class="org-constant">$handler</span> Cvoid ( <span class="org-type">Ptr</span>{Cvoid}, )
    <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_button_onClicked</span>, shlib)
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function return type signature</span>
            , Cvoid
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments</span>
            , ( QButton, <span class="org-type">Ptr</span>{Cvoid}, <span class="org-type">Ptr</span>{Cvoid} )
            <span class="org-comment-delimiter"># </span><span class="org-comment">Arguments passed to function</span>
            , self, <span class="org-constant">C_NULL</span>, callback
            )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">qt_QDoubleSpinBox_value</span>(self<span class="org-default">::</span><span class="org-type">QDoubleSpinbox</span>)
    <span class="org-keyword">return</span> <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_QDoubleSpinBox_value</span>, shlib)
                , <span class="org-type">Cdouble</span>, ( QDoubleSpinbox,)
                , self)
<span class="org-keyword">end</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Wrapper:</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">void qt_msgbox_info(QWidget* parent, const char* title, const char* text);</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_msgbox_info</span>(title<span class="org-default">::</span><span class="org-type">String</span>, text<span class="org-default">::</span><span class="org-type">String</span>)
    <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_msgbox_info</span>, shlib)
          , Cvoid, (<span class="org-type">Ptr</span>{Cvoid}, Cstring, Cstring)
          , <span class="org-constant">C_NULL</span>, title, text
    )
<span class="org-keyword">end</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">void qt_QDoubleSpinBox_onValueChanged(</span>
<span class="org-comment-delimiter">#               </span><span class="org-comment">QDoubleSpinBox* self</span>
<span class="org-comment-delimiter">#             </span><span class="org-comment">, void* ctx, void (* callback)(void* ctx))</span>
<span class="org-keyword">function</span> <span class="org-function-name">qt_QDoubleSpinBox_onValueChanged</span>(self<span class="org-default">::</span><span class="org-type">QDoubleSpinbox</span>, handler)
    callback = <span class="org-julia-macro">@cfunction</span> <span class="org-constant">$handler</span> Cvoid ( <span class="org-type">Ptr</span>{Cvoid}, )
    <span class="org-keyword">ccall</span>(  (<span class="org-julia-quoted-symbol">:qt_QDoubleSpinBox_onValueChanged</span>, shlib)
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function return type signature</span>
            , Cvoid
            <span class="org-comment-delimiter"># </span><span class="org-comment">Function arguments</span>
            , ( QButton, <span class="org-type">Ptr</span>{Cvoid}, <span class="org-type">Ptr</span>{Cvoid} )
            <span class="org-comment-delimiter"># </span><span class="org-comment">Arguments passed to function</span>
            , self, <span class="org-constant">C_NULL</span>, callback
            )
<span class="org-keyword">end</span>

<span class="org-keyword">function</span> <span class="org-function-name">demo_qt_gui_form</span>()
    qapp = QApplication_new()

    window = qt_widget_new( WIDGET_WINDOW_MAIN )
    qt_widget_setText(window, <span class="org-string">"Sample QT GUI in Julia Language"</span>)

    form   = qt_layout_new(LAYOUT_QFORM_LAYOUT, window)

    entry1    = qt_QFormLayout_addWidgetAndLabel(form, WIDGET_QDOUBLE_SPINBOX, <span class="org-string">"Speed in m/s"</span>)
    entry2    = qt_QFormLayout_addWidgetAndLabel(form, WIDGET_QDOUBLE_SPINBOX, <span class="org-string">"Acceleration m/s^2"</span>)
    btn_run   = qt_QFormLayout_addWidgetAndLabel(form, WIDGET_QPUSH_BUTTON,    <span class="org-string">""</span>)
    btn_clean = qt_QFormLayout_addWidgetAndLabel(form, WIDGET_QPUSH_BUTTON,    <span class="org-string">""</span>)
    label     = qt_QFormLayout_addWidgetAndLabel(form, WIDGET_QLABEL,          <span class="org-string">""</span>)

    qt_widget_setText(btn_run,   <span class="org-string">"Run calculations"</span>);
    qt_widget_setText(btn_clean, <span class="org-string">"Clean"</span>);

    println(<span class="org-string">" [INFO] class of form object    = "</span>, qt_qobject_ClassName(form))
    println(<span class="org-string">" [INFO] class of btn_run object = "</span>, qt_qobject_ClassName(btn_run))
    println(<span class="org-string">" [INFO] class of entry1 object  = "</span>, qt_qobject_ClassName(entry1))
    println(<span class="org-string">" [INFO] class of entry2 object  = "</span>, qt_qobject_ClassName(entry2))

    qt_widget_setText(btn_run,   <span class="org-string">"RUN GUI"</span>)
    qt_widget_setText(btn_clean, <span class="org-string">"CLEAN GUI"</span>)

    qt_qobject_print(window)

    update_calculations = (ctx) -&gt; <span class="org-keyword">begin</span>
        speed = qt_QDoubleSpinBox_value(entry1)
        accel = qt_QDoubleSpinBox_value(entry2)
        z = 4.51 * speed + 9.81 * accel^2 / speed
        out = string(<span class="org-string">" [JULIA] Result = "</span>, round(z, digits = 4))
        println(<span class="org-string">" speed = "</span>, speed, <span class="org-string">" ; accel = "</span>, accel)
        println(out)
        println(<span class="org-string">" --------------------------------- "</span>)
        qt_widget_setText(label, out)
    <span class="org-keyword">end</span>

    qt_QDoubleSpinBox_onValueChanged(entry1, update_calculations)
    qt_QDoubleSpinBox_onValueChanged(entry2, update_calculations)

    n = 1
    qt_button_onClicked(btn_run, (ctx) -&gt; <span class="org-keyword">begin</span>
        n = n + 1
        println(<span class="org-string">" [ JULIA ] I was clicked Ok. n = "</span>, n, <span class="org-string">" times. "</span>)
        qt_msgbox_info(<span class="org-string">"Notification"</span>, <span class="org-string">"Button was clicked Ok"</span>)
    <span class="org-keyword">end</span>)

    qt_button_onClicked(btn_clean, (ctx) -&gt; <span class="org-keyword">begin</span>
        println(<span class="org-string">" [TRACE] Button clean clicked Ok"</span>)
        qt_widget_setText(label, <span class="org-string">"Button clean clicked"</span>)
    <span class="org-keyword">end</span>)

    <span class="org-comment-delimiter"># </span><span class="org-comment">--- Block main thread and run QT event loop ---//</span>
    QApplication_exec(qapp)

    <span class="org-comment-delimiter">#  </span><span class="org-comment">----- Dispose objects ----------</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">Only the root widget (window) need to be removed</span>
    qt_qobject_del(window)
    qt_qobject_del(qapp)
<span class="org-keyword">end</span>

demo_qt_gui_form()
</pre>
</div>

<p>
Run julia script / attempt 1 -&gt; error: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ julia loader.jl 
<span class="org-function-name">ERROR</span>: LoadError: could not load library <span class="org-string">"libqtwrapper"</span>
<span class="org-function-name">libqtwrapper.so</span>: cannot open shared object file: No such file or directory
<span class="org-function-name">Stacktrace</span>:
... ... .... ... ... 
... ... ... ... ... 
</pre>
</div>

<p>
Run julia script / attempt 2 -&gt; works: 
</p>

<ul class="org-ul">
<li>Note: LD_LIBRARY_PATH only works on Linux. The equivalent of this
variable for windows is the <span class="underline">PATH</span> environment variable and for
MacOSX, the equivalent is <span class="underline">DYLD_LIBRARY_PATH</span>.</li>
<li>The <span class="underline">libqtwrapper.so</span> shared library can be installed on Linux, by
moving the library file to /lib directory.</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">  $ export <span class="org-variable-name">LD_LIBRARY_PATH</span>=build:$<span class="org-variable-name">LD_LIBRARY_PATH</span>

  $ julia loader.jl 
[TRACE] Create QAppliction Object Ok
[INFO] class of form object    = QFormLayout
[INFO] class of btn_run object = QPushButton
[INFO] class of entry1 object  = QDoubleSpinBox
[INFO] class of entry2 object  = QDoubleSpinBox
speed = 1.0 ; accel = 0.0
[JULIA] Result = 4.51
--------------------------------- 
speed = 2.0 ; accel = 0.0
[JULIA] Result = 9.02
--------------------------------- 
speed = 3.0 ; accel = 0.0
[JULIA] Result = 13.53
--------------------------------- 
... ... ... ... 
</pre>
</div>

<p>
The previous Julia script could also be run in the following way. The
advantage of this method is that, the variable LD_LIBRARY_PATH is only
set for the command: '$ julia loader.jl'. 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ env <span class="org-variable-name">LD_LIBRARY_PATH</span>=build:$<span class="org-variable-name">LD_LIBRARY_PATH</span> julia loade.jl 
</pre>
</div>

<p>
The library can be consumed without setting the environment variable
LD_LIBRARY_PATH on Linux by moving the library file to /usr/lib,
/usr/local/lib or /lib. 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Install shared library to /usr/local/lib</span>
$ sudo cp -v build/libqtwrapper.so /usr/lib 

<span class="org-comment-delimiter"># </span><span class="org-comment">Update library cache </span>
$ sudo ldconfig -v

<span class="org-comment-delimiter"># </span><span class="org-comment">Run the Julia script </span>
$ julia loader.jl 
 [TRACE] Create QAppliction Object Ok
libGL error: MESA-LOADER: failed to open iris (search paths /usr/lib64/dri)
libGL error: failed to load driver: iris
libGL error: MESA-LOADER: failed to open iris (search paths /usr/lib64/dri)
libGL error: failed to load driver: iris
libGL error: MESA-LOADER: failed to open swrast (search paths /usr/lib64/dri)
libGL error: failed to load driver: swrast
 [INFO] class of form object    = QFormLayout
 [INFO] class of btn_run object = QPushButton
... .... .... 
... .... .... 
</pre>
</div>

<p>
User Interface Screenshot: 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-2.png"><img src="images/cwrapper-qt5-2.png" alt="cwrapper-qt5-2.png" /></a>
</p>
<p><span class="figure-number">Figure 3: </span>User interface for Julia language client code.</p>
</div>
</div>
</div>

<div id="outline-container-orgb4964b9" class="outline-4">
<h4 id="orgb4964b9"><span class="section-number-4">1.3.7</span> C# - Dotnet Core Client Code</h4>
<div class="outline-text-4" id="text-1-3-7">
<p>
This section contains the source code of a C# (dotnet) core client
code that loads the C-wrapper shared library (libqwrap.so) for Qt5
widgets framework through dotnet Pinvoke dotnet feature.
</p>


<p>
File: <span class="underline">myapp.csproj</span> 
</p>

<div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">Project</span> <span class="org-nxml-attribute-local-name">Sdk</span>=<span class="org-string">"Microsoft.NET.Sdk"</span><span class="org-nxml-tag-delimiter">&gt;</span>

  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">PropertyGroup</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">OutputType</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">Exe</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">OutputType</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">TargetFramework</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">net5.0</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">TargetFramework</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">PropertyGroup</span><span class="org-nxml-tag-delimiter">&gt;</span>

<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">Project</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>

<p>
File: <span class="underline">Program.cs</span>  - C# Csharp / core source code (dotnet core)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-keyword">using</span> <span class="org-type">System</span>;
<span class="org-keyword">using</span> <span class="org-type">System</span>.Runtime.InteropServices;

<span class="org-keyword">namespace</span> <span class="org-constant">myapp</span>
<span class="org-rainbow-delimiters-depth-1">{</span>

    <span class="org-keyword">class</span> <span class="org-type">Wrapper</span> 
    <span class="org-rainbow-delimiters-depth-2">{</span>
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_WINDOW = 0;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_WINDOW_MAIN = 2;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_QPUSH_BUTTON = 3;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_QLABEL = 4;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_QLINE_EDIT = 5;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> WIDGET_QDOUBLE_SPINBOX = 6;
        <span class="org-keyword">public</span> <span class="org-keyword">const</span> <span class="org-type">int</span> LAYOUT_QFORM_LAYOUT = 3;


        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_app_new2<span class="org-rainbow-delimiters-depth-3">()</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_app_exec<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-3">)</span>;


        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_qobject_del<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_widget_new<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_window_main<span class="org-rainbow-delimiters-depth-3">()</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> <span class="org-type">void</span> qt_widget_setText<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">self</span>, <span class="org-type">string</span> <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> <span class="org-type">void</span> qt_msgbox_info<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">parent</span>, <span class="org-type">string</span> <span class="org-variable-name">title</span>, <span class="org-type">string</span> <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_layout_new<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-3">)</span>; 

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> IntPtr qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span>, <span class="org-type">string</span> <span class="org-variable-name">label</span><span class="org-rainbow-delimiters-depth-3">)</span>; 

        <span class="org-comment-delimiter">// </span><span class="org-comment">A C# delegate is similar to a C++ function pointer type. </span>
        <span class="org-keyword">public</span> delegate <span class="org-type">void</span> button_callback<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-3">)</span>;

        <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-constant">DllImport</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
        <span class="org-keyword">public</span> <span class="org-keyword">static</span> <span class="org-keyword">extern</span> <span class="org-type">void</span> qt_button_onClicked<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">self</span>, <span class="org-type">IntPtr</span> <span class="org-variable-name">ctx</span>, <span class="org-type">button_callback</span> <span class="org-variable-name">callback</span><span class="org-rainbow-delimiters-depth-3">)</span>; 


    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-keyword">class</span> <span class="org-type">Program</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>

        <span class="org-keyword">static</span> <span class="org-type">void</span> Main<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-type">string</span><span class="org-rainbow-delimiters-depth-4">[]</span> args<span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">{</span>
                Console.WriteLine<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">" [TRACE] Program started Ok. "</span><span class="org-rainbow-delimiters-depth-4">)</span>;

            <span class="org-comment-delimiter">// </span><span class="org-comment">Create a QApplication* C++ object </span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">This object must be instantiated before any other Qt Widgets object. </span>
            <span class="org-type">IntPtr</span> <span class="org-variable-name">qapp</span> = Wrapper.qt_app_new2<span class="org-rainbow-delimiters-depth-4">()</span>;
            Console.WriteLine<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">" [TRACE] qapp (IntPtr) value = {0} "</span>, qapp<span class="org-rainbow-delimiters-depth-4">)</span>;


            <span class="org-comment-delimiter">// </span><span class="org-comment">Create a Qt Window object QWidget* </span>
            <span class="org-type">IntPtr</span> <span class="org-variable-name">qwindow</span> = Wrapper.qt_window_main<span class="org-rainbow-delimiters-depth-4">()</span>;
            Wrapper.qt_widget_setText<span class="org-rainbow-delimiters-depth-4">(</span>qwindow, <span class="org-string">"My QtWidget window in C# dotnet core on Linux!"</span><span class="org-rainbow-delimiters-depth-4">)</span>;


            <span class="org-type">IntPtr</span> <span class="org-variable-name">form</span> = Wrapper.qt_layout_new<span class="org-rainbow-delimiters-depth-4">(</span>qwindow,  Wrapper.LAYOUT_QFORM_LAYOUT<span class="org-rainbow-delimiters-depth-4">)</span>;
            <span class="org-type">IntPtr</span> <span class="org-variable-name">btn1</span> = Wrapper.qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-4">(</span>form , Wrapper.WIDGET_QPUSH_BUTTON , <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-4">)</span>;
            Wrapper.qt_widget_setText<span class="org-rainbow-delimiters-depth-4">(</span>btn1, <span class="org-string">"Increment"</span><span class="org-rainbow-delimiters-depth-4">)</span>;

            <span class="org-type">IntPtr</span> <span class="org-variable-name">btn2</span> = Wrapper.qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-4">(</span>form, Wrapper.WIDGET_QPUSH_BUTTON, <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-4">)</span>;
            Wrapper.qt_widget_setText<span class="org-rainbow-delimiters-depth-4">(</span>btn2, <span class="org-string">"Messagebox"</span><span class="org-rainbow-delimiters-depth-4">)</span>;

            <span class="org-type">IntPtr</span> <span class="org-variable-name">text_entry</span> = Wrapper.qt_QFormLayout_addWidgetAndLabel<span class="org-rainbow-delimiters-depth-4">(</span> form, Wrapper.WIDGET_QLINE_EDIT, <span class="org-string">"Result"</span><span class="org-rainbow-delimiters-depth-4">)</span>; 

            <span class="org-comment-delimiter">// </span><span class="org-comment">------------ Set event handlers --------------// </span>
            <span class="org-comment-delimiter">//</span><span class="org-comment">-----------------------------------------------// </span>

            <span class="org-type">int</span> <span class="org-variable-name">counter</span> = 0;

            <span class="org-comment-delimiter">// </span><span class="org-comment">Set button 1 event handler </span>
            Wrapper.qt_button_onClicked<span class="org-rainbow-delimiters-depth-4">(</span>btn1, IntPtr.Zero, <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-5">)</span> =&gt; 
            <span class="org-rainbow-delimiters-depth-5">{</span>
                String s = String.Format<span class="org-rainbow-delimiters-depth-6">(</span><span class="org-string">"Button clicked {0} times."</span>, counter++<span class="org-rainbow-delimiters-depth-6">)</span>;
                Console.WriteLine<span class="org-rainbow-delimiters-depth-6">(</span><span class="org-string">" [TRACE] QtPushButton cliked Ok. =&gt; "</span> + s<span class="org-rainbow-delimiters-depth-6">)</span>;
                Wrapper.qt_widget_setText<span class="org-rainbow-delimiters-depth-6">(</span>text_entry, s<span class="org-rainbow-delimiters-depth-6">)</span>;
            <span class="org-rainbow-delimiters-depth-5">}</span><span class="org-rainbow-delimiters-depth-4">)</span>;

            Wrapper.qt_button_onClicked<span class="org-rainbow-delimiters-depth-4">(</span>btn2, IntPtr.Zero, <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-type">IntPtr</span> <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-5">)</span> =&gt; 
            <span class="org-rainbow-delimiters-depth-5">{</span>
                Wrapper.qt_msgbox_info<span class="org-rainbow-delimiters-depth-6">(</span>IntPtr.Zero , <span class="org-string">"System Notification"</span> , <span class="org-string">"Batch workload finished Ok."</span> <span class="org-rainbow-delimiters-depth-6">)</span>;
            <span class="org-rainbow-delimiters-depth-5">}</span><span class="org-rainbow-delimiters-depth-4">)</span>;

            <span class="org-comment-delimiter">// </span><span class="org-comment">Run application and block current thread. </span>
            Wrapper.qt_app_exec<span class="org-rainbow-delimiters-depth-4">(</span>qapp<span class="org-rainbow-delimiters-depth-4">)</span>;

            <span class="org-comment-delimiter">// </span><span class="org-comment">---- Dispose C++ objects -------------------//</span>
            <span class="org-comment-delimiter">// </span><span class="org-comment">--------------------------------------------//</span>
            Wrapper.qt_qobject_del<span class="org-rainbow-delimiters-depth-4">(</span>qwindow<span class="org-rainbow-delimiters-depth-4">)</span>;
            Wrapper.qt_qobject_del<span class="org-rainbow-delimiters-depth-4">(</span>qapp<span class="org-rainbow-delimiters-depth-4">)</span>;
            Console.WriteLine<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">" [TRACE] Program terminated successfully Ok. "</span><span class="org-rainbow-delimiters-depth-4">)</span>;
        <span class="org-rainbow-delimiters-depth-3">}</span>
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>


</pre>
</div>

<p>
<b>Building</b> 
</p>

<p>
The following command sets the LD_LIBRARY_PATH environment variable
for allowing the linker (aka loader) to find the shared library
(libqtwrapper.so on Linux or BSD or qtwrapper.dll on Windows). On
Windows, the operating system will linker will look for the shared
library on the same directory where is the executable, then on
predefined directories such as <span class="underline">C:\\Windows\\System32\</span>, and finally on
directories listed in the %PATH% enviroment variable.  
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">export</span> <span class="org-variable-name">LD_LIBRARY_PATH</span>=$<span class="org-variable-name">HOME</span>/_build/
</pre>
</div>

<p>
Adding the shared library directory path to the %PATH% enviroment
variable has the same effect of setting LD_LIBRARY_PATH on Linux. This
setting can be performed on cmd.exe shell via the as in the following
code block. The shared library can be located without setting the PATH
variable by moving it to the System32 directory or placing it on the
same directory where is the executable.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">set</span> <span class="org-variable-name">PATH</span>=<span class="org-string">"%cd%\_build\path\to\shared\library\directory"</span>;%PATH%
</pre>
</div>

<p>
Build from command line: 
</p>

<div class="org-src-container">
<pre class="src src-sh">
$ ~/dotnet/dotnet build myapp.csproj
<span class="org-function-name">Microsoft</span> (R) Build Engine version 16.9.0+57a23d249 for .NET
<span class="org-function-name">Copyright</span> (C) Microsoft Corporation. All rights reserved.

  Determining projects to restore...
  All projects are up-to-date for restore.
  myapp -&gt; /home/unixuser/Documents/temp-projects/qt5-cwrapper/bin/Debug/net5.0/myapp.dll

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:01.06


</pre>
</div>

<p>
Check the executable: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ tree ./bin
./bin
&#9492;&#9472;&#9472; Debug
    &#9492;&#9472;&#9472; net5.0
        &#9500;&#9472;&#9472; myapp
        &#9500;&#9472;&#9472; myapp.deps.json
        &#9500;&#9472;&#9472; myapp.dll
        &#9500;&#9472;&#9472; myapp.pdb
        &#9500;&#9472;&#9472; myapp.runtimeconfig.dev.json
        &#9500;&#9472;&#9472; myapp.runtimeconfig.json
        &#9492;&#9472;&#9472; ref
            &#9492;&#9472;&#9472; myapp.dll

3 directories, 7 files

 $ ldd bin/Debug/net5.0/myapp
        linux-vdso.so.1 (0x00007fff251d4000)
        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fa56e3e0000)
        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fa56e3da000)
        libstdc++.so.6 =&gt; /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fa56e1f9000)
        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fa56e0aa000)
        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fa56e08f000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa56dea5000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fa56e64b000)
</pre>
</div>

<p>
Running the application: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ file bin/Debug/net5.0/myapp
<span class="org-function-name">bin/Debug/net5.0/myapp</span>: ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), dynamically linked, 
interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, <span class="org-variable-name">BuildID</span>[sha1]=1894b9678ab18e8406448464668a8949e4f9d2b5, stripped

 $ ~/Documents/temp-projects/qt5-cwrapper master
 $ bin/Debug/net5.0/myapp
 [TRACE] Program started Ok. 
 [TRACE] Create QAppliction Object Ok
 [TRACE] qapp (IntPtr) value = 94225009981200 
 [TRACE] QtPushButton cliked Ok. =&gt; Button clicked 0 times.
 ... ... ... .. 
 ... ... ... ... ... ... ... ..
</pre>
</div>

<p>
Running the application via dotnet core tool: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ~/dotnet/dotnet run --project=myapp.csproj
</pre>
</div>

<p>
<b>Screenshot</b> 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-5.png"><img src="images/cwrapper-qt5-5.png" alt="cwrapper-qt5-5.png" /></a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgefec1a7" class="outline-4">
<h4 id="orgefec1a7"><span class="section-number-4">1.3.8</span> D language - D-lang Client Code</h4>
<div class="outline-text-4" id="text-1-3-8">
<p>
Note: This client code load function pointers from the C-wrapper
shared library at runtime via Dlopen() API. The benefit of this
approach over linking directly, at-compile time, is that application
can build on machines without Qt installation or on dockers images
without X11 installed. 
</p>

<p>
<b>Files:</b> 
</p>

<p>
File: <span class="underline">d_client.d</span> (Dlang / D-language client code)
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">import</span> <span class="org-variable-name">core</span>.stdc.stdio;
<span class="org-type">import</span> <span class="org-variable-name">std</span>.range: empty;
<span class="org-type">import</span> <span class="org-variable-name">str</span> = std.string;

<span class="org-comment-delimiter">// </span><span class="org-comment">Import dlopen</span>
<span class="org-type">import</span> <span class="org-variable-name">DLL</span> = core.sys.posix.dlfcn;

<span class="org-type">alias</span> <span class="org-variable-name">QLayout</span>         = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QObject</span>         = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QWidget</span>         = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QLabel</span>          = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QApplication</span>    = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QPushButton</span>     = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QFormLayout</span>     = <span class="org-type">void</span>;
<span class="org-type">alias</span> <span class="org-variable-name">QAbstractButton</span> = <span class="org-type">void</span>;


<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_WINDOW</span>           = 1;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_WINDOW_MAIN</span>      = 2;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QPUSH_BUTTON</span>     = 3;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QLABEL</span>           = 4;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QLINE_EDIT</span>       = 5;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">WIDGET_QDOUBLE_SPINBOX</span>  = 6;
<span class="org-keyword">const</span> <span class="org-type">int</span> <span class="org-variable-name">LAYOUT_QFORM_LAYOUT</span> = 3;

<span class="org-type">alias</span> <span class="org-variable-name">qapp_new_t</span>          = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> QApplication* function <span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qapp_exec_t</span>         = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">int</span>      <span class="org-function-name">function</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QApplication</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qobject_del_t</span>       = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">void</span>     <span class="org-function-name">function</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QObject</span>*<span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qt_widget_new_t</span>     = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> QWidget* function<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qt_window_main_t</span>    = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">QWidget</span>* <span class="org-function-name">function</span><span class="org-rainbow-delimiters-depth-1">()</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qt_widget_setText_t</span> = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">void</span>     <span class="org-function-name">function</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">self</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qt_layout_new_t</span>     = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> QLayout* function <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-type">alias</span> <span class="org-variable-name">qt_msgbox_info_t</span>    = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">void</span>     <span class="org-function-name">function</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QWidget</span>* <span class="org-variable-name">parent</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">title</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">text</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment-delimiter">// </span><span class="org-comment">QObject* qt_QFormLayout_addWidgetAndLabel(QFormLayout* self, int type, const char* label)</span>
<span class="org-type">alias</span> <span class="org-variable-name">qt_QFormLayout_addWidgetAndLabel_t</span> =
        <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> QPushButton* function <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">QFormLayout</span>* <span class="org-variable-name">self</span>, <span class="org-type">int</span> <span class="org-variable-name">type</span>, <span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">label</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-type">alias</span> <span class="org-variable-name">qt_button_onClicked_t</span> = <span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">void</span> <span class="org-function-name">function</span> <span class="org-rainbow-delimiters-depth-1">(</span> <span class="org-type">QAbstractButton</span>* <span class="org-variable-name">self</span>
                                                      , <span class="org-type">void</span>* <span class="org-variable-name">ctx</span>
                                                      , <span class="org-type">void</span> <span class="org-function-name">function</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">void</span>* <span class="org-variable-name">self</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-1">)</span>;


<span class="org-keyword">struct</span> <span class="org-type">callback_state</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">int</span>                 <span class="org-variable-name">counter</span>           = 0;
    <span class="org-type">QLabel</span>*             <span class="org-variable-name">label</span>             = null;
    <span class="org-type">qt_widget_setText_t</span> <span class="org-variable-name">qt_widget_setText</span> = null;
    <span class="org-type">qt_msgbox_info_t</span>    <span class="org-variable-name">qt_msgbox_info</span>    = null;
<span class="org-rainbow-delimiters-depth-1">}</span>;

<span class="org-keyword">extern</span><span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">void</span> <span class="org-function-name">button_callback1</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">void</span>* <span class="org-variable-name">ctx</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">import</span> <span class="org-variable-name">std</span>.conv: to;

    <span class="org-keyword">auto</span> <span class="org-variable-name">pstate</span> = cast<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">callback_state</span>*<span class="org-rainbow-delimiters-depth-2">)</span> ctx;
    pstate.counter = pstate.counter + 1;
    printf<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" [TRACE] Button click event happened =&gt; state = %d. \n"</span>, pstate.counter<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-type">string</span> <span class="org-variable-name">text</span> = <span class="org-string">"Button clicked / counter = "</span>;
    text = text ~ to<span class="org-negation-char">!</span>string<span class="org-rainbow-delimiters-depth-2">(</span>pstate.counter<span class="org-rainbow-delimiters-depth-2">)</span>;

    pstate.qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>pstate.label, str.toStringz<span class="org-rainbow-delimiters-depth-3">(</span>text<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">if</span><span class="org-rainbow-delimiters-depth-2">(</span>pstate.counter &gt; 20<span class="org-rainbow-delimiters-depth-2">){</span>
        pstate.qt_msgbox_info<span class="org-rainbow-delimiters-depth-3">(</span>null, <span class="org-string">"QT Event =&gt; Button Clicked"</span>, str.toStringz<span class="org-rainbow-delimiters-depth-4">(</span>text<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">int</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">()</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-comment-delimiter">// </span><span class="org-comment">------------- Load Symbols from Shared Library -------------------//</span>

    <span class="org-type">void</span>* <span class="org-variable-name">dll</span> = DLL.dlopen<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">"./build/libqtwrapper.so"</span>, DLL.RTLD_GLOBAL | DLL.RTLD_LAZY<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-negation-char">!</span>dll<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">{</span>
        fprintf<span class="org-rainbow-delimiters-depth-3">(</span>stderr, <span class="org-string">" [ERROR] dlopen error: %s\n"</span>, DLL.dlerror<span class="org-rainbow-delimiters-depth-4">()</span><span class="org-rainbow-delimiters-depth-3">)</span>;
        <span class="org-keyword">return</span> 1;
    <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-keyword">auto</span>  <span class="org-variable-name">qapp_new</span>   = cast<span class="org-rainbow-delimiters-depth-2">(</span>qapp_new_t<span class="org-rainbow-delimiters-depth-2">)</span> DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_app_new2"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span>  <span class="org-variable-name">qapp_exec</span>   = cast<span class="org-rainbow-delimiters-depth-2">(</span>qapp_exec_t<span class="org-rainbow-delimiters-depth-2">)</span> DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_app_exec"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_qobject_del</span>      = cast<span class="org-rainbow-delimiters-depth-2">(</span>qobject_del_t<span class="org-rainbow-delimiters-depth-2">)</span>         DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_qobject_del"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_widget_new</span>       = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_widget_new_t<span class="org-rainbow-delimiters-depth-2">)</span>       DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_widget_new"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_layout_new</span>       = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_widget_new_t<span class="org-rainbow-delimiters-depth-2">)</span>       DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_layout_new"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_window_main</span>      = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_window_main_t<span class="org-rainbow-delimiters-depth-2">)</span>      DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_window_main"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_widget_setText</span>   = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_widget_setText_t<span class="org-rainbow-delimiters-depth-2">)</span>   DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_widget_setText"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_button_onClicked</span> = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_button_onClicked_t<span class="org-rainbow-delimiters-depth-2">)</span> DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_button_onClicked"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">qt_msgbox_info</span>      = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_msgbox_info_t<span class="org-rainbow-delimiters-depth-2">)</span>      DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_msgbox_info"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">form_add_item</span> = cast<span class="org-rainbow-delimiters-depth-2">(</span>qt_QFormLayout_addWidgetAndLabel_t<span class="org-rainbow-delimiters-depth-2">)</span> DLL.dlsym<span class="org-rainbow-delimiters-depth-2">(</span>dll, <span class="org-string">"qt_QFormLayout_addWidgetAndLabel"</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    assert<span class="org-rainbow-delimiters-depth-2">(</span>form_add_item<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">---------- Create QT GUI -----------------------------//</span>
    <span class="org-comment-delimiter">//</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Create an instance of class QApplication</span>
    <span class="org-keyword">auto</span> <span class="org-variable-name">qapp</span>   = qapp_new<span class="org-rainbow-delimiters-depth-2">()</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">window</span> = qt_widget_new<span class="org-rainbow-delimiters-depth-2">(</span>null, WIDGET_WINDOW_MAIN<span class="org-rainbow-delimiters-depth-2">)</span> ;
    assert<span class="org-rainbow-delimiters-depth-2">(</span> window <span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>window, <span class="org-string">"QT Widgets GUI in D Language"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">auto</span> <span class="org-variable-name">form</span>  = qt_layout_new<span class="org-rainbow-delimiters-depth-2">(</span>window, LAYOUT_QFORM_LAYOUT<span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">btn</span>   = form_add_item<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QPUSH_BUTTON, <span class="org-string">""</span><span class="org-rainbow-delimiters-depth-2">)</span>;
    <span class="org-keyword">auto</span> <span class="org-variable-name">label</span> = form_add_item<span class="org-rainbow-delimiters-depth-2">(</span>form, WIDGET_QLABEL,       <span class="org-string">"Display"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    qt_widget_setText<span class="org-rainbow-delimiters-depth-2">(</span>btn, <span class="org-string">"Click ME NOW!!"</span><span class="org-rainbow-delimiters-depth-2">)</span>;


    <span class="org-type">callback_state</span> <span class="org-variable-name">state</span>;
    state.counter = 10;
    state.label   = label;
    state.qt_msgbox_info = qt_msgbox_info;
    state.qt_widget_setText = qt_widget_setText;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Install button event handler</span>
    qt_button_onClicked<span class="org-rainbow-delimiters-depth-2">(</span>btn, &amp;state, &amp;button_callback1<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">------ Run QT Event Loop blocking main thread ------//</span>
    qapp_exec<span class="org-rainbow-delimiters-depth-2">(</span>qapp<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">------ Dipose QT Objects ---------------------------//</span>
    <span class="org-comment-delimiter">//</span>
    qt_qobject_del<span class="org-rainbow-delimiters-depth-2">(</span>window<span class="org-rainbow-delimiters-depth-2">)</span>;
    qt_qobject_del<span class="org-rainbow-delimiters-depth-2">(</span>qapp<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-keyword">return</span> 0;
<span class="org-rainbow-delimiters-depth-1">}</span>
</pre>
</div>


<p>
Run file d_client.d as a script: 
</p>

<pre class="example">
$ rdmd d_client.d 
 [TRACE] Create QAppliction Object Ok
 [TRACE] Button click event happened =&gt; state = 11. 
 [TRACE] Button click event happened =&gt; state = 12. 
 [TRACE] Button click event happened =&gt; state = 13. 
 [TRACE] Button click event happened =&gt; state = 14. 
 [TRACE] Button click event happened =&gt; state = 15. 
  ... ... ... ... ... ... ... ...   
</pre>

<p>
Build and run executable: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ dmd d_client.d -g 

$ ./d_client 
 [TRACE] Create QAppliction Object Ok
 [TRACE] Button click event happened =&gt; state = 11. 
 [TRACE] Button click event happened =&gt; state = 12. 
 [TRACE] Button click event happened =&gt; state = 13.
 ... ... ...  ... ... ...  ... ... ...  ... ... ... 
 ... ... ...  ... ... ...  ... ... ...  ... ... ... 
</pre>
</div>

<p>
User Interface Screenshot: 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-3.png"><img src="images/cwrapper-qt5-3.png" alt="cwrapper-qt5-3.png" /></a>
</p>
<p><span class="figure-number">Figure 5: </span>User interface for Dlang (D Language)</p>
</div>
</div>
</div>

<div id="outline-container-org7f02432" class="outline-4">
<h4 id="org7f02432"><span class="section-number-4">1.3.9</span> <span class="todo TODO">TODO</span> Rust client code</h4>
<div class="outline-text-4" id="text-1-3-9">
<p>
File: <span class="underline">rustclient.rs</span>
</p>

<div class="org-src-container">
<pre class="src src-cpp"><span class="org-type">use</span> <span class="org-constant">std</span>::<span class="org-variable-name">os</span>;
<span class="org-type">use</span> <span class="org-constant">std</span>::<span class="org-constant">path</span>::<span class="org-variable-name">Path</span>;

<span class="org-type">use</span> <span class="org-constant">std</span>::<span class="org-constant">os</span>::<span class="org-variable-name">raw</span>::<span class="org-rainbow-delimiters-depth-1">{</span>c_int, c_char, c_long, c_void, c_uint, c_short<span class="org-rainbow-delimiters-depth-1">}</span>;
<span class="org-type">use</span> <span class="org-constant">std</span>::<span class="org-constant">ffi</span>::<span class="org-variable-name">CString</span>;
<span class="org-type">use</span> <span class="org-constant">std</span>::<span class="org-variable-name">mem</span>;

<span class="org-type">type</span> <span class="org-variable-name">c_str</span>  = *<span class="org-keyword">const</span> c_char;

<span class="org-type">type</span> <span class="org-variable-name">LPVOID</span>  = *mut c_void;
<span class="org-type">type</span> <span class="org-variable-name">QObject</span> = LPVOID;
<span class="org-type">type</span> <span class="org-variable-name">QWidget</span> = LPVOID;
<span class="org-type">type</span> <span class="org-variable-name">QLabel</span>  = LPVOID;
<span class="org-type">type</span> <span class="org-variable-name">QApplication</span> = LPVOID;
<span class="org-type">type</span> <span class="org-variable-name">QPushButton</span> = LPVOID;

<span class="org-comment-delimiter">// </span><span class="org-comment">void* null pointer</span>
<span class="org-keyword">const</span> <span class="org-type">null_ptr</span>: LPVOID = <span class="org-constant">std</span>::<span class="org-constant">ptr</span>::null_mut<span class="org-rainbow-delimiters-depth-1">()</span>;

<span class="org-keyword">const</span> <span class="org-type">WIDGET_WINDOW</span>:          c_int = 0;
<span class="org-keyword">const</span> <span class="org-type">WIDGET_WINDOW_MAIN</span>:     c_int = 2;
<span class="org-keyword">const</span> <span class="org-type">WIDGET_QPUSH_BUTTON</span>:    c_int = 3;
<span class="org-keyword">const</span> <span class="org-type">WIDGET_QLABEL</span>:          c_int = 4;
<span class="org-keyword">const</span> <span class="org-type">WIDGET_QLINE_EDIT</span>:      c_int = 5;
<span class="org-keyword">const</span> <span class="org-type">WIDGET_QDOUBLE_SPINBOX</span>: c_int = 6;
<span class="org-keyword">const</span> <span class="org-type">LAYOUT_QFORM_LAYOUT</span>:    c_int = 3;


<span class="org-comment-delimiter">// </span><span class="org-comment">Function pointer type alias </span>
<span class="org-comment-delimiter">// </span><span class="org-comment">type qt_object_del_t = unsafe extern "C" fn(this: QObject) -&gt; c_void;</span>

#<span class="org-rainbow-delimiters-depth-1">[</span>no_mangle<span class="org-rainbow-delimiters-depth-1">]</span>
<span class="org-keyword">extern</span> <span class="org-string">"C"</span> fn btn_callback1<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">this</span>: QWidget, ctx: LPVOID<span class="org-rainbow-delimiters-depth-1">)</span> -&gt; LPVOID 
<span class="org-rainbow-delimiters-depth-1">{</span>
    unsafe <span class="org-rainbow-delimiters-depth-2">{</span>
        let <span class="org-type">mut</span>&amp; <span class="org-variable-name">counter</span> = ctx as *mut c_int;
        *counter = *counter + 1;
        println<span class="org-negation-char">!</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">" [TRACE] Button clicked Ok  =&gt; counter = {}"</span>, *counter<span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
    <span class="org-keyword">return</span> null_ptr;
<span class="org-rainbow-delimiters-depth-1">}</span>


<span class="org-type">fn</span> <span class="org-function-name">main</span><span class="org-rainbow-delimiters-depth-1">(){</span>
    println<span class="org-negation-char">!</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-string">" Hello world!"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-type">let</span> <span class="org-variable-name">qapp</span>: QApplication = app_new<span class="org-rainbow-delimiters-depth-2">()</span>; 

    <span class="org-type">let</span> <span class="org-variable-name">button</span>: QWidget = widget_new<span class="org-rainbow-delimiters-depth-2">(</span>null_ptr, WIDGET_QPUSH_BUTTON<span class="org-rainbow-delimiters-depth-2">)</span>;
    widget_set_text<span class="org-rainbow-delimiters-depth-2">(</span>button, <span class="org-string">"Click me now!"</span><span class="org-rainbow-delimiters-depth-2">)</span>;

    unsafe<span class="org-rainbow-delimiters-depth-2">{</span> qt_widget_show<span class="org-rainbow-delimiters-depth-3">(</span>button<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-2">}</span>;

    <span class="org-type">let</span> <span class="org-type">mut</span> <span class="org-variable-name">counter</span>: c_int = 0;

    unsafe<span class="org-rainbow-delimiters-depth-2">{</span> qt_button_onClicked<span class="org-rainbow-delimiters-depth-3">(</span>button, counter <span class="org-type">as</span> *<span class="org-variable-name">mut</span> _, btn_callback1<span class="org-rainbow-delimiters-depth-3">)</span>; <span class="org-rainbow-delimiters-depth-2">}</span>

    <span class="org-comment-delimiter">// </span><span class="org-comment">Run QT event loop and block current thread </span>
    app_exec<span class="org-rainbow-delimiters-depth-2">(</span>qapp<span class="org-rainbow-delimiters-depth-2">)</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">void (* callback) (void* ctx) )</span>
<span class="org-type">type</span> <span class="org-variable-name">button_callback</span> = unsafe <span class="org-keyword">extern</span> <span class="org-string">"C"</span> fn<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">this</span>: QWidget, ctx: LPVOID<span class="org-rainbow-delimiters-depth-1">)</span> -&gt; LPVOID;


#<span class="org-rainbow-delimiters-depth-1">[</span>link<span class="org-rainbow-delimiters-depth-2">(</span>name = <span class="org-string">"qtwrapper"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>
<span class="org-keyword">extern</span> <span class="org-string">"C"</span> <span class="org-rainbow-delimiters-depth-1">{</span>

    <span class="org-type">fn</span> <span class="org-variable-name">qt_object_del</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">this</span>: QObject<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; c_void;

    <span class="org-type">fn</span> <span class="org-function-name">qt_app_new2</span><span class="org-rainbow-delimiters-depth-2">()</span> -&gt; QApplication;
    <span class="org-type">fn</span> <span class="org-variable-name">qt_app_exec</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">this</span>: QApplication<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; c_void;

    <span class="org-type">fn</span> <span class="org-function-name">qt_widget_new</span><span class="org-rainbow-delimiters-depth-2">(</span>parent: QWidget, typ: c_int<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; QWidget;

    <span class="org-type">fn</span> <span class="org-variable-name">qt_widget_show</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">this</span>: QWidget<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; c_void;

    <span class="org-type">fn</span> <span class="org-function-name">qt_QPushButton_new</span><span class="org-rainbow-delimiters-depth-2">(</span>parent: QWidget, label: c_str<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; QPushButton;

    <span class="org-type">fn</span> <span class="org-function-name">qt_msgbox_info</span><span class="org-rainbow-delimiters-depth-2">(</span>parent: QWidget, title: c_str, text: c_str<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; c_void;

        <span class="org-comment-delimiter">// </span><span class="org-comment">void qt_widget_setText(QWidget* self, const char* text)</span>
    <span class="org-type">fn</span> <span class="org-variable-name">qt_widget_setText</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">this</span>: QWidget, text: c_str<span class="org-rainbow-delimiters-depth-2">)</span>;

    <span class="org-comment-delimiter">// </span><span class="org-comment">void  qt_button_onClicked(QAbstractButton* self, void* ctx, void (* callback) (void*) );</span>

    <span class="org-type">fn</span> <span class="org-variable-name">qt_button_onClicked</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">this</span>: QWidget, ctx: LPVOID, callback: button_callback<span class="org-rainbow-delimiters-depth-2">)</span> -&gt; c_void;
    <span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-comment-delimiter">// </span><span class="org-comment">-------- Safe wrappers to unsafe operations ------------//</span>

<span class="org-type">fn</span> <span class="org-function-name">app_new</span><span class="org-rainbow-delimiters-depth-1">()</span> -&gt; QApplication
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">let</span> <span class="org-variable-name">qapp</span>: QApplication = unsafe <span class="org-rainbow-delimiters-depth-2">{</span> qt_app_new2<span class="org-rainbow-delimiters-depth-3">()</span> <span class="org-rainbow-delimiters-depth-2">}</span>;
    <span class="org-keyword">return</span> qapp;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">fn</span> <span class="org-function-name">app_exec</span><span class="org-rainbow-delimiters-depth-1">(</span>qapp: QApplication<span class="org-rainbow-delimiters-depth-1">)</span> 
<span class="org-rainbow-delimiters-depth-1">{</span>
    unsafe<span class="org-rainbow-delimiters-depth-2">{</span> qt_app_exec<span class="org-rainbow-delimiters-depth-3">(</span>qapp<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-2">}</span>;
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">fn</span> <span class="org-variable-name">widget_set_text</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">this</span>: QWidget, text: &amp;str<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">let</span> <span class="org-variable-name">text</span> = <span class="org-constant">CString</span>::<span class="org-keyword">new</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">text</span><span class="org-rainbow-delimiters-depth-2">)</span>.unwrap<span class="org-rainbow-delimiters-depth-2">()</span>; 
    unsafe <span class="org-rainbow-delimiters-depth-2">{</span>
        qt_widget_setText<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">this</span>, text.as_ptr<span class="org-rainbow-delimiters-depth-4">()</span> <span class="org-rainbow-delimiters-depth-3">)</span>;
    <span class="org-rainbow-delimiters-depth-2">}</span>
<span class="org-rainbow-delimiters-depth-1">}</span>

<span class="org-type">fn</span> <span class="org-function-name">widget_new</span><span class="org-rainbow-delimiters-depth-1">(</span>parent: LPVOID, typ: c_int<span class="org-rainbow-delimiters-depth-1">)</span> -&gt; QWidget
<span class="org-rainbow-delimiters-depth-1">{</span>
    <span class="org-type">let</span> <span class="org-variable-name">wdg</span>: QWidget = unsafe<span class="org-rainbow-delimiters-depth-2">{</span> qt_widget_new<span class="org-rainbow-delimiters-depth-3">(</span>parent, typ<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-2">}</span>;
    <span class="org-keyword">return</span> wdg;
<span class="org-rainbow-delimiters-depth-1">}</span>


</pre>
</div>

<p>
Building: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ rustc rustclient.rs -l qtwrapper -L_build/
</pre>
</div>

<p>
Running: 
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ./rustclient 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1a910f" class="outline-4">
<h4 id="orgf1a910f"><span class="section-number-4">1.3.10</span> Common Lisp client code</h4>
<div class="outline-text-4" id="text-1-3-10">
<p>
This common lisp client code, more specifically Stell Bank Common Lisp
(SBCL), loads the shared library <span class="underline">libqtwrapper.so</span> by using CFFI
foreign-function interface library.
</p>

<p>
Procedure for install SBCL on Fedora 32 and dependencies:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Fedora as root </span>
$ dnf install sbcl 

<span class="org-comment-delimiter"># </span><span class="org-comment">Download and install quicklisp </span>
$ &gt;&gt; curl -O -L http://beta.quicklisp.org/quicklisp.lisp 
$ &gt;&gt; rlwrap sbcl --load quicklisp.lisp 

<span class="org-comment-delimiter"># </span><span class="org-comment">Run sbcl and install quicklisp</span>
$ &gt;&gt; rlwrap sbcl --load quicklisp.lisp
* (quicklisp-quickstart:install)
* (ql:add-to-init-file)

<span class="org-comment-delimiter"># </span><span class="org-comment">Install CFFI </span>
* (ql:quickload <span class="org-string">"cffi"</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">Quit SBCL repl </span>
* (quit)
</pre>
</div>

<p>
File: <span class="underline">sbcl_client.lisp</span> 
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">---- Experimental binding to Qt5 GUI Framework ----------;;</span>
<span class="org-comment-delimiter">;;</span>
(<span class="org-keyword">require</span> <span class="org-constant">:cffi</span>)

(cffi:define-foreign-library qtw (<span class="org-builtin">:unix</span> <span class="org-string">"libqtwrapper.so"</span> ))
(cffi:use-foreign-library qtw )

<span class="org-comment-delimiter">;; </span><span class="org-comment">------- Define bindings ---------------------------..</span>

(cffi:defcfun <span class="org-string">"qt_app_new2"</span>   <span class="org-builtin">:pointer</span>)
(cffi:defcfun <span class="org-string">"qt_widget_new"</span>  <span class="org-builtin">:pointer</span> (parent <span class="org-builtin">:pointer</span>) (type <span class="org-builtin">:int</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: void qt_widget_show(QWidget* self)</span>
(cffi:defcfun <span class="org-string">"qt_widget_show"</span> <span class="org-builtin">:void</span>    (self <span class="org-builtin">:pointer</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: int qt_app_exec(QApplication* self)</span>
(cffi:defcfun <span class="org-string">"qt_app_exec"</span> <span class="org-builtin">:int</span> (self <span class="org-builtin">:pointer</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: void qt_qobject_del(QObject* self)</span>
(cffi:defcfun <span class="org-string">"qt_qobject_del"</span> <span class="org-builtin">:void</span> (self <span class="org-builtin">:pointer</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: void qt_widget_setText(QWidget* self, const char* text)</span>
(cffi:defcfun <span class="org-string">"qt_widget_setText"</span> <span class="org-builtin">:void</span> (self <span class="org-builtin">:pointer</span>) (text <span class="org-builtin">:string</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: QLayout* qt_layout_new(QWidget* parent, int type)</span>
(cffi:defcfun <span class="org-string">"qt_layout_new"</span> <span class="org-builtin">:pointer</span> (self <span class="org-builtin">:pointer</span>) (type <span class="org-builtin">:int</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: QObject* qt_QFormLayout_addWidgetAndLabel(</span>
<span class="org-comment-delimiter">;;                            </span><span class="org-comment">QFormLayout* self</span>
<span class="org-comment-delimiter">;;                          </span><span class="org-comment">, int type, const char* label)</span>
(cffi:defcfun <span class="org-string">"qt_QFormLayout_addWidgetAndLabel"</span>
               <span class="org-builtin">:pointer</span> (self <span class="org-builtin">:pointer</span>) (type <span class="org-builtin">:int</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Callback </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">---------------------------------------------------</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">-----------------------------------------------------</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">void qt_button_onClicked( </span>
<span class="org-comment-delimiter">;;                </span><span class="org-comment">QAbstractButton* self</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">, void* ctx</span>
<span class="org-comment-delimiter">;;               </span><span class="org-comment">, void (* callback) (void* self) )</span>
(cffi:defcfun <span class="org-string">"qt_button_onClicked"</span>
               <span class="org-builtin">:void</span> (self <span class="org-builtin">:pointer</span>) (ctx <span class="org-builtin">:pointer</span>) (callback <span class="org-builtin">:pointer</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Signature: void qt_msgbox_info( QWidget* parent</span>
<span class="org-comment-delimiter">;;                                </span><span class="org-comment">, const char* title</span>
<span class="org-comment-delimiter">;;                                </span><span class="org-comment">, const char* text )</span>
(cffi:defcfun <span class="org-string">"qt_msgbox_info"</span>
               <span class="org-builtin">:void</span> (parent <span class="org-builtin">:pointer</span>) (title <span class="org-builtin">:string</span>) (text <span class="org-builtin">:string</span>))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">WIDGET-WINDOW-MAIN</span> 2)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">WIDGET-BUTTON</span>      3)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">WIDGET-LINE-EDIT</span>   5)
(<span class="org-keyword">defvar</span> <span class="org-variable-name">LAYOUT-QFORM</span>       3)

<span class="org-comment-delimiter">;; </span><span class="org-comment">----- Define variables --------------------------- ;;</span>
<span class="org-comment-delimiter">;;</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">This function must always be called</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">before creating any widget.</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">qapp</span>   (qt-app-new2))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Create main window </span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">window</span> (qt-widget-new (cffi:null-pointer) WIDGET-WINDOW-MAIN))

(cffi:with-foreign-string (title <span class="org-string">"My LISP QT Window"</span>)
                          (qt-widget-settext window title))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">form</span> (qt-layout-new window LAYOUT-QFORM))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Note: Common Lisp is case insensitive </span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">button</span>     (qt-QFormLayout-addWidgetAndLabel form WIDGET-BUTTON))
(<span class="org-keyword">defvar</span> <span class="org-variable-name">line-edit</span>  (qt-QFormLayout-addWidgetAndLabel form WIDGET-LINE-EDIT))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Set button label </span>
(cffi:with-foreign-string (title <span class="org-string">"click me"</span>)
                          (qt-widget-settext button title))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">counter</span> 0)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Define button callback</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">void (* callback) (void* self) )</span>
(cffi:defcallback button-callback
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Return type of callback</span>
             <span class="org-builtin">:void</span>               
             <span class="org-comment-delimiter">;; </span><span class="org-comment">List containing callback arguments</span>
             ( (ctx <span class="org-builtin">:pointer</span>) )  
             <span class="org-comment-delimiter">;; </span><span class="org-comment">Function main body </span>
             (<span class="org-keyword">progn</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Increment counter</span>
               (setf counter (+ counter 1))

               (cffi:with-foreign-string
                      (text (format nil <span class="org-string">"counter set to ~a"</span> counter ))
                      (qt-widget-settext button text))

               (cffi:with-foreign-string
                   (title <span class="org-string">"User notification"</span>)
                   (cffi:with-foreign-string
                      (text <span class="org-string">"Counter clicked"</span>)
                      (qt-msgbox-info window title text)))

               (print (format t <span class="org-string">"Counter set to = ~D \n"</span> counter))

               ))
              <span class="org-comment-delimiter">;; </span><span class="org-comment">--- End of button callback() ----- ;;</span>

(qt-button-onClicked button (cffi:null-pointer)
                            (cffi:callback button-callback))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Run QT event loop and blocks current thread. </span>
(qt-app-exec qapp)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Dispose C++ objects calling destructors </span>
(qt-qobject-del window)
(qt-qobject-del qapp)
</pre>
</div>

<p>
Run Common Lisp Client Code: 
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ &gt;&gt; export <span class="org-variable-name">LD_LIBRARY_PATH</span>=$<span class="org-variable-name">PWD</span>/build

 $ &gt;&gt; sbcl --load sbcl_client.lisp
This is SBCL 2.0.1-1.fc32, an implementation of ANSI Common Lisp.
More information about SBCL is available at <a href="http://www.sbcl.org/">&lt;http://www.sbcl.org/&gt;</a>.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly<span class="org-keyword"> in</span> the public domain; some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files<span class="org-keyword"> in</span> the
distribution for more information.
 [TRACE] Create QAppliction Object Ok
 ... ... ... ... ...  
</pre>
</div>

<p>
User interface screenshot: 
</p>


<div class="figure">
<p><a href="images/cwrapper-qt5-4.png"><img src="images/cwrapper-qt5-4.png" alt="cwrapper-qt5-4.png" /></a>
</p>
<p><span class="figure-number">Figure 6: </span>User interface for Common Lisp (SBCL) client code.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2021-09-27 Mon 19:26</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
